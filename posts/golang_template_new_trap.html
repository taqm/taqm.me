<!DOCTYPE html><html lang="ja"><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-X38HKLJWTQ"></script><script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-X38HKLJWTQ', { page_path: window.location.pathname, }); </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="robots" content="nofollow noindex"/><title>Go言語のtext/templateでNewするときの名前について | taqm&#x27;s blog</title><meta name="keywords" content="Golang"/><meta name="description" content="Go言語の標準パッケージ&#x27;text/template&#x27;を利用した際にハマった罠の解説です。"/><meta property="og:url" content="https://taqm.me/posts/golang_template_new_trap"/><meta property="og:type" content="article"/><meta property="og:title" content="Go言語のtext/templateでNewするときの名前について | taqm&amp;apos;s blog"/><meta property="og:image" content="https://taqm.me/static/site_logo.png"/><meta property="og:description" content="Go言語の標準パッケージ&#x27;text/template&#x27;を利用した際にハマった罠の解説です。"/><meta property="og:site_name" content="taqm.me"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="taqm"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/3bd3ee853585bdba2b55.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3bd3ee853585bdba2b55.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-8741ed3c7ec57f378f59.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-95c2b224bccf352ee870.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.daa7383ad2ab2e6757c1.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.286c5ad94e4334e87283.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-62c4ae74494db6a57e9e.js" as="script"/><link rel="preload" href="/_next/static/chunks/79afb1f29f0e22fb2195c114356294f95861ebcc.293ad4049eec03f4e065.js" as="script"/><link rel="preload" href="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.26412b03d1df03d45396.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-d84c8237cab24ecd19e3.js" as="script"/><style id="__jsx-2615209551">.inner.jsx-2615209551{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:2.5rem;}@media (min-width:640px){.inner.jsx-2615209551{-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;height:4rem;padding-left:1.5rem;padding-right:1.5rem;}}</style></head><body><div id="__next"><header class="jsx-2615209551 border-b border-gray-200 bg-white"><div class="jsx-2615209551 inner max-w-screen-lg mx-auto"><a class="jsx-2615209551 text-xl sm:text-2xl" href="/">taqm&#x27;blog</a></div></header><main class="container py-16"><article class="post-page"><div class="text-sm text-gray-500">2018-09-10</div><h1 class="text-2xl font-bold">Go言語のtext/templateでNewするときの名前について</h1><ul class="flex flex-wrap mt-2"><li class="mr-2 bg-gray-200 hover:bg-gray-300"><a class="block px-2 h-full text-sm" href="/tags/Golang">Golang</a></li></ul><div class="mt-10"><p class="paragraph">Go言語の標準パッケージである<code class="code">text/template</code>について
けっこうハマってしまったのでメモとして残します。</p>
<h2 class="heading lv-2">.ParseFilesを利用する場合の、template.Newの引数</h2>
<p class="paragraph">まずは以下のコードを見てください</p>
<div class="remark-highlight"><pre class="language-go pre"><code class="language-go code"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	tmpl <span class="token string">"text/template"</span>
	<span class="token string">"os"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	t <span class="token operator">:=</span> tmpl<span class="token punctuation">.</span><span class="token function">Must</span><span class="token punctuation">(</span>tmpl<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"mytemplate"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> t<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">,</span> <span class="token string">"taqm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p class="paragraph">■ test.txt</p>
<div class="remark-highlight"><pre class="language-unknown pre"><code class="language-unknown code">Hello {{ . }}</code></pre></div>
<p class="paragraph">test.txtを読み込んで、"taqm"というパラメータを渡して標準出力へ吐き出しています。
実際にこのコードを実行してみると...</p>
<blockquote>
<p class="paragraph">panic: template: "mytemplate" is an incomplete or empty template</p>
</blockquote>
<p class="paragraph">なんか怒られた...
こういうときはじっくりエラー文言を呼んでみることが重要！</p>
<blockquote>
<p class="paragraph">"mytemplate"は不完全または空のテンプレートです [by Google翻訳]</p>
</blockquote>
<p class="paragraph">「中身は空じゃないし文法がおかしかったのかな？」ってことで、
テンプレートの文法がおかしいのかもう一度調べ直してみました。</p>
<p class="paragraph"><code class="code">template.New</code>をせずに<code class="code">template.ParseFiles</code>だと問題なく動くことを確認。
つまり<code class="code">New</code>していることが原因なのか？</p>
<p class="paragraph">調べていると<a href="https://qiita.com/akiraak/items/aa259b3988e00c2a3820" class="anchor" rel="noopener noreferrer" target="_blank">ある記事</a>に答えはありました。</p>
<p class="paragraph"><code class="code">template.New</code>の後ろで<code class="code">ParseFiles</code>を呼ぶ場合は、
<code class="code">ParseFiles</code>の引数に設定するファイルパスの<strong>ファイル名</strong>を設定する必要があるらしい！</p>
<div class="remark-highlight"><pre class="language-go pre"><code class="language-go code">t <span class="token operator">:=</span> tmpl<span class="token punctuation">.</span><span class="token function">Must</span><span class="token punctuation">(</span>tmpl<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"mytemplate"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<p class="paragraph">↓ mytemplateをファイル名に変更</p>
<div class="remark-highlight"><pre class="language-go pre"><code class="language-go code">t <span class="token operator">:=</span> tmpl<span class="token punctuation">.</span><span class="token function">Must</span><span class="token punctuation">(</span>tmpl<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<p class="paragraph">やっと動きました・・・＾＾
なんだかんだ1時間くらいハマってしまいました。</p>
<p class="paragraph">素直にエラーメッセージでGoogle検索していればもっと早くに気付けたのかもしれません。
ですが、Goの公式ドキュメント見たり、ソースコードを見たりしたので
結果的に得るものは多かったのかなと思います。</p>
<p class="paragraph">もし同じことでハマった人がすぐにこのページにたどり着けるといいなってことで！</p>
<p class="paragraph">おわり＾＾</p>
<h2 class="heading lv-2">参考ページ</h2>
<ul class="list unordered">
<li><a href="https://qiita.com/akiraak/items/aa259b3988e00c2a3820" class="anchor" rel="noopener noreferrer" target="_blank">html/templateで自作の関数を利用する</a></li>
</ul></div></article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":"{\"slug\":\"golang_template_new_trap\",\"title\":\"Go言語のtext/templateでNewするときの名前について\",\"publishedAt\":\"2018-09-10T00:34:00.000Z\",\"description\":\"Go言語の標準パッケージ'text/template'を利用した際にハマった罠の解説です。\",\"tags\":[\"Golang\"]}","content":"\u003cp class=\"paragraph\"\u003eGo言語の標準パッケージである\u003ccode class=\"code\"\u003etext/template\u003c/code\u003eについて\nけっこうハマってしまったのでメモとして残します。\u003c/p\u003e\n\u003ch2 class=\"heading lv-2\"\u003e.ParseFilesを利用する場合の、template.Newの引数\u003c/h2\u003e\n\u003cp class=\"paragraph\"\u003eまずは以下のコードを見てください\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-go pre\"\u003e\u003ccode class=\"language-go code\"\u003e\u003cspan class=\"token keyword\"\u003epackage\u003c/span\u003e main\n\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n\ttmpl \u003cspan class=\"token string\"\u003e\"text/template\"\u003c/span\u003e\n\t\u003cspan class=\"token string\"\u003e\"os\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\tt \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e tmpl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eMust\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etmpl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eNew\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"mytemplate\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eParseFiles\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"test.txt\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e t\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eExecute\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eStdout\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"taqm\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e err \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"token function\"\u003epanic\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e■ test.txt\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown pre\"\u003e\u003ccode class=\"language-unknown code\"\u003eHello {{ . }}\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003etest.txtを読み込んで、\"taqm\"というパラメータを渡して標準出力へ吐き出しています。\n実際にこのコードを実行してみると...\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp class=\"paragraph\"\u003epanic: template: \"mytemplate\" is an incomplete or empty template\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp class=\"paragraph\"\u003eなんか怒られた...\nこういうときはじっくりエラー文言を呼んでみることが重要！\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp class=\"paragraph\"\u003e\"mytemplate\"は不完全または空のテンプレートです [by Google翻訳]\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp class=\"paragraph\"\u003e「中身は空じゃないし文法がおかしかったのかな？」ってことで、\nテンプレートの文法がおかしいのかもう一度調べ直してみました。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e\u003ccode class=\"code\"\u003etemplate.New\u003c/code\u003eをせずに\u003ccode class=\"code\"\u003etemplate.ParseFiles\u003c/code\u003eだと問題なく動くことを確認。\nつまり\u003ccode class=\"code\"\u003eNew\u003c/code\u003eしていることが原因なのか？\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e調べていると\u003ca href=\"https://qiita.com/akiraak/items/aa259b3988e00c2a3820\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\"\u003eある記事\u003c/a\u003eに答えはありました。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e\u003ccode class=\"code\"\u003etemplate.New\u003c/code\u003eの後ろで\u003ccode class=\"code\"\u003eParseFiles\u003c/code\u003eを呼ぶ場合は、\n\u003ccode class=\"code\"\u003eParseFiles\u003c/code\u003eの引数に設定するファイルパスの\u003cstrong\u003eファイル名\u003c/strong\u003eを設定する必要があるらしい！\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-go pre\"\u003e\u003ccode class=\"language-go code\"\u003et \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e tmpl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eMust\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etmpl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eNew\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"mytemplate\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eParseFiles\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"test.txt\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e↓ mytemplateをファイル名に変更\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-go pre\"\u003e\u003ccode class=\"language-go code\"\u003et \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e tmpl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eMust\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etmpl\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eNew\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"test.txt\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eParseFiles\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"test.txt\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003eやっと動きました・・・＾＾\nなんだかんだ1時間くらいハマってしまいました。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e素直にエラーメッセージでGoogle検索していればもっと早くに気付けたのかもしれません。\nですが、Goの公式ドキュメント見たり、ソースコードを見たりしたので\n結果的に得るものは多かったのかなと思います。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eもし同じことでハマった人がすぐにこのページにたどり着けるといいなってことで！\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eおわり＾＾\u003c/p\u003e\n\u003ch2 class=\"heading lv-2\"\u003e参考ページ\u003c/h2\u003e\n\u003cul class=\"list unordered\"\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/akiraak/items/aa259b3988e00c2a3820\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\"\u003ehtml/templateで自作の関数を利用する\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"golang_template_new_trap"},"buildId":"2TeC_BqFkmcRD1K9YUrqZ","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-51ce6eb9ed73aacaf515.js"></script><script src="/_next/static/chunks/main-8741ed3c7ec57f378f59.js" async=""></script><script src="/_next/static/chunks/webpack-95c2b224bccf352ee870.js" async=""></script><script src="/_next/static/chunks/framework.daa7383ad2ab2e6757c1.js" async=""></script><script src="/_next/static/chunks/commons.286c5ad94e4334e87283.js" async=""></script><script src="/_next/static/chunks/pages/_app-62c4ae74494db6a57e9e.js" async=""></script><script src="/_next/static/chunks/79afb1f29f0e22fb2195c114356294f95861ebcc.293ad4049eec03f4e065.js" async=""></script><script src="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.26412b03d1df03d45396.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-d84c8237cab24ecd19e3.js" async=""></script><script src="/_next/static/2TeC_BqFkmcRD1K9YUrqZ/_buildManifest.js" async=""></script><script src="/_next/static/2TeC_BqFkmcRD1K9YUrqZ/_ssgManifest.js" async=""></script></body></html>