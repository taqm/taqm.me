<!DOCTYPE html><html lang="ja"><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-X38HKLJWTQ"></script><script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-X38HKLJWTQ', { page_path: window.location.pathname, }); </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="robots" content="nofollow noindex"/><title>TypeScriptでVuexを型安全に扱うライブラリを作りました | taqm&#x27;s blog</title><meta name="keywords" content="Vue,TypeScript"/><meta name="description" content="vuexをTypeScriptで扱う際に可能な限り型安全にするライブラリを作ったので解説と紹介を行います。"/><meta property="og:url" content="https://taqm.me/posts/vuex_typesafe_library"/><meta property="og:type" content="article"/><meta property="og:title" content="TypeScriptでVuexを型安全に扱うライブラリを作りました | taqm&amp;apos;s blog"/><meta property="og:image" content="https://taqm.me/static/site_logo.png"/><meta property="og:description" content="vuexをTypeScriptで扱う際に可能な限り型安全にするライブラリを作ったので解説と紹介を行います。"/><meta property="og:site_name" content="taqm.me"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="taqm"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/3bd3ee853585bdba2b55.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3bd3ee853585bdba2b55.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-8741ed3c7ec57f378f59.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-95c2b224bccf352ee870.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.daa7383ad2ab2e6757c1.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.286c5ad94e4334e87283.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-62c4ae74494db6a57e9e.js" as="script"/><link rel="preload" href="/_next/static/chunks/79afb1f29f0e22fb2195c114356294f95861ebcc.293ad4049eec03f4e065.js" as="script"/><link rel="preload" href="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.26412b03d1df03d45396.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-d84c8237cab24ecd19e3.js" as="script"/><style id="__jsx-2615209551">.inner.jsx-2615209551{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:2.5rem;}@media (min-width:640px){.inner.jsx-2615209551{-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;height:4rem;padding-left:1.5rem;padding-right:1.5rem;}}</style></head><body><div id="__next"><header class="jsx-2615209551 border-b border-gray-200 bg-white"><div class="jsx-2615209551 inner max-w-screen-lg mx-auto"><a class="jsx-2615209551 text-xl sm:text-2xl" href="/">taqm&#x27;blog</a></div></header><main class="container py-16"><article class="post-page"><div class="text-sm text-gray-500">2018-10-14</div><h1 class="text-2xl font-bold">TypeScriptでVuexを型安全に扱うライブラリを作りました</h1><ul class="flex flex-wrap mt-2"><li class="mr-2 bg-gray-200 hover:bg-gray-300"><a class="block px-2 h-full text-sm" href="/tags/Vue">Vue</a></li><li class="mr-2 bg-gray-200 hover:bg-gray-300"><a class="block px-2 h-full text-sm" href="/tags/TypeScript">TypeScript</a></li></ul><div class="mt-10"><h2 class="heading lv-2">はじめに</h2>
<p class="paragraph">こんにちは。
みなさんVue&#x26;Vuex&#x26;TypeScript やってますか？</p>
<p class="paragraph">Vueクラススタイルコンポーネント向けのライブラリのなかで
<a href="https://github.com/ktsn/vuex-class" class="anchor" rel="noopener noreferrer" target="_blank">vuex-class</a>というライブラリがすごく気に入ったのですが型安全ではありません。
↑ リポジトリを見るとIssueは立ってるようです</p>
<p class="paragraph">そこで今回、車輪の再発明を承知でライブラリを作りました！
<code class="code">vuex-class</code>的な使い心地で型安全なものを目指します:point_up:</p>
<h2 class="heading lv-2">コード</h2>
<p class="paragraph">まずは作ったものはこちら
<a href="https://www.npmjs.com/package/vuex-map-decorators" class="anchor" rel="noopener noreferrer" target="_blank">vuex-map-decorators</a></p>
<p class="paragraph">基本的にデコレータを実装しているので、
実装内容より先に使い方を説明します。</p>
<h2 class="heading lv-2">使い方</h2>
<h3 class="heading lv-3">シンプルな使い方</h3>
<div class="remark-highlight"><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">import</span> <span class="token punctuation">{</span> State<span class="token punctuation">,</span> Mutation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex-map-decorators'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">SampleState</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">HogeState</span> <span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">SampleMutation</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">increment</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@Component
<span class="token keyword">class</span> <span class="token class-name">Sample</span> <span class="token keyword">extends</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>
  @<span class="token generic-function"><span class="token function">State</span><span class="token generic class-name"><span class="token operator">&#x3C;</span>SampleState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">)</span>
  count<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  @<span class="token generic-function"><span class="token function">Mutation</span><span class="token generic class-name"><span class="token operator">&#x3C;</span>SampleMutation<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span>
  onClick<span class="token operator">!</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>

  @<span class="token generic-function"><span class="token function">State</span><span class="token generic class-name"><span class="token operator">&#x3C;</span>HogeState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token string">'sample'</span><span class="token punctuation">)</span> <span class="token comment">// 第二引数はnamespace (sample/message)</span>
  message<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token comment">// SampleStateに存在しないキーはコンパイルエラーになる</span>
  @<span class="token generic-function"><span class="token function">State</span><span class="token generic class-name"><span class="token operator">&#x3C;</span>SampleState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span> <span class="token comment">// &#x3C;- Error</span>
  message<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h4 class="heading lv-4">解説</h4>
<p class="paragraph"><code class="code">@State</code>をつけたプロパティへはVuexStoreのstate部分が割り当てられます。
例では<code class="code">@State</code>と<code class="code">@Mutation</code>のみですが、
<code class="code">@Getter</code>と<code class="code">@Action</code>も用意しており使い勝手は全て同じです。</p>
<p class="paragraph">引数|マップされる先
---|---|---
@State&#x3C;T>(key: keyof T, namespace?: string | undefined)| computed
@Mutation&#x3C;T>(key: keyof T, namespace?: string | undefined)| methods
@Getter&#x3C;T>(key: keyof T, namespace?: string | undefined)| computed
@Actions&#x3C;T>(key: keyof T, namespace?: string | undefined)| methods</p>
<p class="paragraph">デコレータの第一引数は<code class="code">&#x3C;T>(keyof T)</code>となっているため、
型引数<code class="code">&#x3C;T></code>の型に存在しないキーを渡せないようになっています。</p>
<p class="paragraph">デコレータをつけるプロパティの型については、
このままだと任意になってしまい微妙なので対応したいところですね。
内容がライブラリと少し離れてしまうため別の記事にしたいと思います。</p>
<h3 class="heading lv-3">Namespaceを意識した使い方</h3>
<p class="paragraph">前述した内容では確かに型安全になりますが、あまりにも記述する内容が多すぎます。
そこでNamespaceを意識した方法を用意していますので紹介します。(むしろこっちがメイン</p>
<div class="remark-highlight"><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">namespace</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex-map-decorators'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">SampleState</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> state<span class="token operator">:</span> SampleState <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> getters <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> ns <span class="token operator">=</span> <span class="token keyword">namespace</span><span class="token operator">&#x3C;</span>
  SampleState<span class="token punctuation">,</span>
  <span class="token keyword">typeof</span> mutations<span class="token punctuation">,</span>
  <span class="token keyword">typeof</span> getters<span class="token punctuation">,</span>
  <span class="token keyword">typeof</span> action<span class="token punctuation">,</span>
<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">'sample'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

@Component
<span class="token keyword">class</span> <span class="token class-name">Sample</span> <span class="token keyword">extends</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>
  @ns<span class="token punctuation">.</span><span class="token function">State</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  count<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ↓ これと同じ意味になります</span>
@<span class="token generic-function"><span class="token function">State</span><span class="token generic class-name"><span class="token operator">&#x3C;</span>SampleState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'sample'</span><span class="token punctuation">)</span>
</code></pre></div>
<h4 class="heading lv-4">解説</h4>
<p class="paragraph"><code class="code">namespace</code>関数に<code class="code">state</code>, <code class="code">mutaions</code>, <code class="code">getters</code>, <code class="code">actions</code>の順で型を渡して、
引数には名前空間を文字列で渡します。</p>
<p class="paragraph">もし「<code class="code">getters</code>はないんだよね」って時は、型に<code class="code">never</code>を渡してあげてください</p>
<div class="remark-highlight"><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">const</span> ns <span class="token operator">=</span> <span class="token keyword">namespace</span><span class="token operator">&#x3C;</span>
  SampleState<span class="token punctuation">,</span>
  <span class="token keyword">typeof</span> mutations<span class="token punctuation">,</span>
  <span class="token builtin">never</span><span class="token punctuation">,</span>      <span class="token comment">// 実装していない部分はneverで</span>
  <span class="token keyword">typeof</span> action<span class="token punctuation">,</span>
<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">'sample'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ns<span class="token punctuation">.</span>Getter <span class="token comment">// &#x3C;- ここではエラーになる</span>
</code></pre></div>
<p class="paragraph">型に<code class="code">never</code>を渡すことで、返却されるオブジェクトの型が変わり、
参照そのものができなくなります。</p>
<div class="remark-highlight"><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">const</span> ns1 <span class="token operator">=</span> <span class="token keyword">namespace</span><span class="token operator">&#x3C;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">,</span> <span class="token constant">D</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string">'sample'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*</span>
<span class="token comment">  ns1 = {</span>
<span class="token comment">    State(k: keyof A){},</span>
<span class="token comment">    Mutation(k: keyof B){},</span>
<span class="token comment">    Getter(k: keyof C){},</span>
<span class="token comment">    Action(k: keyof D){},</span>
<span class="token comment">  }</span>
<span class="token comment">*/</span>

<span class="token keyword">const</span> ns2 <span class="token operator">=</span> <span class="token keyword">namespace</span><span class="token operator">&#x3C;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token builtin">never</span><span class="token punctuation">,</span> <span class="token builtin">never</span><span class="token punctuation">,</span> <span class="token constant">D</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string">'sample'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*</span>
<span class="token comment">  ns2 = {</span>
<span class="token comment">    State(k: keyof A){},</span>
<span class="token comment">    Action(k: keyof D){},</span>
<span class="token comment">  }</span>
<span class="token comment">*/</span>
</code></pre></div>
<h4 class="heading lv-4">従来のVuexコンテキストを利用する場合</h4>
<p class="paragraph">デコレータを使わず<code class="code">commit</code>や<code class="code">dispatch</code>を利用する場合です。
やはりどうしてもデコレータだけだと辛いこともあるかもしれないので、
以下のような手段を用意しました</p>
<div class="remark-highlight"><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">interface</span> <span class="token class-name">Mutations</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">increment</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> State<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> ns <span class="token operator">=</span> <span class="token keyword">namespace</span><span class="token operator">&#x3C;</span>State<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">'views/sample'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> key <span class="token operator">=</span> ns<span class="token punctuation">.</span><span class="token function">Mutation</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>key<span class="token punctuation">;</span> <span class="token comment">// views/sample/increment</span>
$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p class="paragraph">少し野暮ったいですが、文字リテラルでも型に守られるため
この手段を使うこともありかと思います。
ただし、Payloadの型までは現時点で推論できないため今後の課題です。</p>
<h3 class="heading lv-3">実装内容</h3>
<p class="paragraph">実装は１ファイルです。
まずはデコレータを作成するところをみてみます</p>
<h4 class="heading lv-4">デコレータ作成部分</h4>
<div class="remark-highlight"><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">function</span> <span class="token function">createVuexDecorator</span><span class="token punctuation">(</span>
  bindTo<span class="token operator">:</span> <span class="token string">'computed'</span> <span class="token operator">|</span> <span class="token string">'methods'</span><span class="token punctuation">,</span>
  mapper<span class="token operator">:</span> VuexMapper<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">unknown</span><span class="token operator">></span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">,</span> namesapce<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token operator">:</span> VuexDecorator <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">key is not string: key=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, ns=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>namesapce<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> dec <span class="token operator">=</span> <span class="token function">createDecorator</span><span class="token punctuation">(</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>target<span class="token punctuation">[</span>bindTo<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">[</span>bindTo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      target<span class="token punctuation">[</span>bindTo<span class="token punctuation">]</span><span class="token operator">!</span><span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
        namesapce <span class="token operator">?</span> <span class="token function">mapper</span><span class="token punctuation">(</span>namesapce<span class="token punctuation">,</span> <span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">mapper</span><span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">as</span> VuexDecorator<span class="token punctuation">;</span>
    dec<span class="token punctuation">.</span>key <span class="token operator">=</span> namesapce <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>namesapce<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> key<span class="token punctuation">;</span>
    <span class="token keyword">return</span> dec<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> State <span class="token operator">=</span> <span class="token function">createVuexDecorator</span><span class="token punctuation">(</span><span class="token string">'computed'</span><span class="token punctuation">,</span> mapState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> Mutation <span class="token operator">=</span> <span class="token function">createVuexDecorator</span><span class="token punctuation">(</span><span class="token string">'methods'</span><span class="token punctuation">,</span> mapMutations<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> Getter <span class="token operator">=</span> <span class="token function">createVuexDecorator</span><span class="token punctuation">(</span><span class="token string">'computed'</span><span class="token punctuation">,</span> mapGetters<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> Action <span class="token operator">=</span> <span class="token function">createVuexDecorator</span><span class="token punctuation">(</span><span class="token string">'methods'</span><span class="token punctuation">,</span> mapActions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p class="paragraph"><code class="code">createVuexDecorator</code>を呼ぶことでそれぞれのデコレータを作成しています。</p>
<h5 class="heading lv-5">引数</h5>
<div class="remark-highlight"><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">type</span> <span class="token class-name">VuexMapper</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token operator">|</span> <span class="token keyword">typeof</span> mapState
  <span class="token operator">|</span> <span class="token keyword">typeof</span> mapMutations
  <span class="token operator">|</span> <span class="token keyword">typeof</span> mapGetters
  <span class="token operator">|</span> <span class="token keyword">typeof</span> mapActions
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createVuexDecorator</span><span class="token punctuation">(</span>
  bindTo<span class="token operator">:</span> <span class="token string">'computed'</span> <span class="token operator">|</span> <span class="token string">'methods'</span><span class="token punctuation">,</span>
  mapper<span class="token operator">:</span> VuexMapper<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div>
<p class="paragraph">どこに何でマッピングするかを定義します。
<code class="code">State</code>の場合は「computedにmapState」でマッピングを行なっています。
<code class="code">VuexMapper</code>はvuex標準の<code class="code">mapXXXX</code>のどれかです。</p>
<h5 class="heading lv-5">デコレータの実装部分</h5>
<div class="remark-highlight"><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">import</span> <span class="token punctuation">{</span> createDecorator<span class="token punctuation">,</span> VueDecorator <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-class-component'</span><span class="token punctuation">;</span>
<span class="token keyword">interface</span> <span class="token class-name">VuexDecorator</span> <span class="token keyword">extends</span> <span class="token class-name">VueDecorator</span> <span class="token punctuation">{</span>
  key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*</span>
<span class="token comment">  中略</span>
<span class="token comment">*/</span>
  <span class="token keyword">return</span> <span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">unknown</span><span class="token operator">></span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">,</span> namesapce<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token operator">:</span> VuexDecorator <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 入力チェックは省略</span>
    <span class="token keyword">const</span> dec <span class="token operator">=</span> <span class="token function">createDecorator</span><span class="token punctuation">(</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>target<span class="token punctuation">[</span>bindTo<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">[</span>bindTo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      target<span class="token punctuation">[</span>bindTo<span class="token punctuation">]</span><span class="token operator">!</span><span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
        namesapce <span class="token operator">?</span> <span class="token function">mapper</span><span class="token punctuation">(</span>namesapce<span class="token punctuation">,</span> <span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">mapper</span><span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">as</span> VuexDecorator<span class="token punctuation">;</span>
    dec<span class="token punctuation">.</span>key <span class="token operator">=</span> namesapce <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>namesapce<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> key<span class="token punctuation">;</span>
    <span class="token keyword">return</span> dec<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<h5 class="heading lv-5">戻り値</h5>
<p class="paragraph">Vue公式の<code class="code">vue-class-component</code>内の<code class="code">VueDecorator</code>を拡張しており、
<strong>従来のVuexコンテキストを利用する場合</strong>内で説明した<code class="code">key</code>を追加しています。</p>
<h5 class="heading lv-5">本体</h5>
<p class="paragraph">まずは受け取った型から引数を絞ります。
ここではVue公式の<code class="code">createDecorator</code>を利用することで実装がとてもシンプルになります。</p>
<p class="paragraph"><code class="code">target</code>はコンポーネントで、<code class="code">prop</code>はデコレータがついていたプロパティになり、
<code class="code">target['computed' | 'methods']</code>へ <code class="code">mapXXXX</code>の結果を突っ込んでいく形で実装しています。</p>
<h4 class="heading lv-4">名前空間作成部分</h4>
<p class="paragraph">この戻りの型定義が一番面白いところです！
そしてなくても困らない部分です...:smile:</p>
<div class="remark-highlight"><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token keyword">namespace</span><span class="token operator">&#x3C;</span>
  <span class="token constant">S</span> <span class="token operator">=</span> <span class="token builtin">never</span><span class="token punctuation">,</span>
  <span class="token constant">M</span> <span class="token operator">=</span> <span class="token builtin">never</span><span class="token punctuation">,</span>
  <span class="token constant">G</span> <span class="token operator">=</span> <span class="token builtin">never</span><span class="token punctuation">,</span>
  <span class="token constant">A</span> <span class="token operator">=</span> <span class="token builtin">never</span><span class="token punctuation">,</span>
<span class="token operator">></span><span class="token punctuation">(</span>n<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> DecoratorInterface<span class="token operator">&#x3C;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token punctuation">,</span> <span class="token constant">G</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">State</span><span class="token operator">:</span> <span class="token punctuation">(</span>k<span class="token operator">:</span> <span class="token keyword">keyof</span> <span class="token constant">S</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token generic-function"><span class="token function">State</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token constant">S</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">Mutation</span><span class="token operator">:</span> <span class="token punctuation">(</span>k<span class="token operator">:</span> <span class="token keyword">keyof</span> <span class="token constant">M</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token generic-function"><span class="token function">Mutation</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token constant">M</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">Getter</span><span class="token operator">:</span> <span class="token punctuation">(</span>k<span class="token operator">:</span> <span class="token keyword">keyof</span> <span class="token constant">G</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token generic-function"><span class="token function">Getter</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token constant">G</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">Action</span><span class="token operator">:</span> <span class="token punctuation">(</span>k<span class="token operator">:</span> <span class="token keyword">keyof</span> <span class="token constant">A</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token generic-function"><span class="token function">Action</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token constant">A</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p class="paragraph">見ての通り、先ほど作成したデコレータにnamespaceを渡し、オブジェクトに固めているだけです。
この際にデコレータの引数で名前空間を受け取れなくしています。</p>
<p class="paragraph">ここで戻り値の型となっている<code class="code">DecoratorInterface</code>の説明を行いましょう！</p>
<h5 class="heading lv-5">名前空間オブジェクトの型</h5>
<p class="paragraph">型定義は以下のようになっています。</p>
<div class="remark-highlight"><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">type</span> <span class="token class-name">IsNever<span class="token operator">&#x3C;</span><span class="token constant">N</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">N</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token builtin">never</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token string">'T'</span> <span class="token operator">:</span> <span class="token string">'F'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">IfNotNever<span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">R</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token constant">T</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">F</span><span class="token operator">:</span> <span class="token constant">R</span> <span class="token punctuation">}</span><span class="token punctuation">[</span>IsNever<span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">DecoratorMaker<span class="token operator">&#x3C;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>k<span class="token operator">:</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=></span> VuexDecorator<span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">DecoratorInterface<span class="token operator">&#x3C;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token punctuation">,</span> <span class="token constant">G</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token operator">&#x26;</span> IfNotNever<span class="token operator">&#x3C;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> State<span class="token operator">:</span> DecoratorMaker<span class="token operator">&#x3C;</span><span class="token constant">S</span><span class="token operator">></span> <span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token operator">&#x26;</span> IfNotNever<span class="token operator">&#x3C;</span><span class="token constant">M</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> Mutation<span class="token operator">:</span> DecoratorMaker<span class="token operator">&#x3C;</span><span class="token constant">M</span><span class="token operator">></span> <span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token operator">&#x26;</span> IfNotNever<span class="token operator">&#x3C;</span><span class="token constant">G</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> Getter<span class="token operator">:</span> DecoratorMaker<span class="token operator">&#x3C;</span><span class="token constant">G</span><span class="token operator">></span> <span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token operator">&#x26;</span> IfNotNever<span class="token operator">&#x3C;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> Action<span class="token operator">:</span> DecoratorMaker<span class="token operator">&#x3C;</span><span class="token constant">A</span><span class="token operator">></span> <span class="token punctuation">}</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p class="paragraph">はい出ました。TypeScript型遊びの時間です。</p>
<h6>IsNever&#x3C;N></h6>
<p class="paragraph">NがNeverかどうかを判定し,
NがNeverの場合は<code class="code">'T'</code>、違う場合は<code class="code">'F'</code>を返却します。
ちなみにここでいう<code class="code">'T'</code>は値ではなく<code class="code">'T'</code>という型です。</p>
<p class="paragraph">ここで<code class="code">[never]</code>のように配列にしなかった場合、うまくいきませんでした。
ハマったので調べてみるとTypeScript本家のIssueに書いてあってのでなんとか解決。
<a href="https://github.com/Microsoft/TypeScript/issues/23182" class="anchor" rel="noopener noreferrer" target="_blank">https://github.com/Microsoft/TypeScript/issues/23182</a></p>
<h6>IfNotNever&#x3C;T, R></h6>
<p class="paragraph">先ほど定義した<code class="code">IsNever</code>を利用します。
もし<code class="code">T</code>がneverだった場合は空オブジェクトを、違う場合は<code class="code">R</code>を返却します。
こうすることで、neverじゃない場合のみ、プロパティが参照できるようになります。</p>
<h2 class="heading lv-2">あとがき</h2>
<p class="paragraph">自分で作ったので当然ですが、
なかなか使い勝手がいい感じに仕上がりました。</p>
<p class="paragraph">実際に使い込んでみて都合が悪いことがあれば都度直していきたいと思います。</p>
<p class="paragraph">やっぱりTypeScriptの型でモニョモニョするのは楽しいですね:relaxed:</p>
<p class="paragraph">おしまい</p></div></article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":"{\"slug\":\"vuex_typesafe_library\",\"title\":\"TypeScriptでVuexを型安全に扱うライブラリを作りました\",\"publishedAt\":\"2018-10-14T01:31:27.000Z\",\"description\":\"vuexをTypeScriptで扱う際に可能な限り型安全にするライブラリを作ったので解説と紹介を行います。\",\"tags\":[\"Vue\",\"TypeScript\"]}","content":"\u003ch2 class=\"heading lv-2\"\u003eはじめに\u003c/h2\u003e\n\u003cp class=\"paragraph\"\u003eこんにちは。\nみなさんVue\u0026#x26;Vuex\u0026#x26;TypeScript やってますか？\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eVueクラススタイルコンポーネント向けのライブラリのなかで\n\u003ca href=\"https://github.com/ktsn/vuex-class\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\"\u003evuex-class\u003c/a\u003eというライブラリがすごく気に入ったのですが型安全ではありません。\n↑ リポジトリを見るとIssueは立ってるようです\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eそこで今回、車輪の再発明を承知でライブラリを作りました！\n\u003ccode class=\"code\"\u003evuex-class\u003c/code\u003e的な使い心地で型安全なものを目指します:point_up:\u003c/p\u003e\n\u003ch2 class=\"heading lv-2\"\u003eコード\u003c/h2\u003e\n\u003cp class=\"paragraph\"\u003eまずは作ったものはこちら\n\u003ca href=\"https://www.npmjs.com/package/vuex-map-decorators\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\"\u003evuex-map-decorators\u003c/a\u003e\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e基本的にデコレータを実装しているので、\n実装内容より先に使い方を説明します。\u003c/p\u003e\n\u003ch2 class=\"heading lv-2\"\u003e使い方\u003c/h2\u003e\n\u003ch3 class=\"heading lv-3\"\u003eシンプルな使い方\u003c/h3\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e State\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Mutation \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'vuex-map-decorators'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSampleState\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  count\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eHogeState\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSampleMutation\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function-variable function\"\u003eincrement\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n@Component\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSample\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  @\u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003eState\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eSampleState\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'count'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  count\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  @\u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003eMutation\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eSampleMutation\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'increment'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  onClick\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  @\u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003eState\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eHogeState\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'message'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'sample'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// 第二引数はnamespace (sample/message)\u003c/span\u003e\n  message\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token comment\"\u003e// SampleStateに存在しないキーはコンパイルエラーになる\u003c/span\u003e\n  @\u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003eState\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eSampleState\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'message'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// \u0026#x3C;- Error\u003c/span\u003e\n  message\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eany\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 class=\"heading lv-4\"\u003e解説\u003c/h4\u003e\n\u003cp class=\"paragraph\"\u003e\u003ccode class=\"code\"\u003e@State\u003c/code\u003eをつけたプロパティへはVuexStoreのstate部分が割り当てられます。\n例では\u003ccode class=\"code\"\u003e@State\u003c/code\u003eと\u003ccode class=\"code\"\u003e@Mutation\u003c/code\u003eのみですが、\n\u003ccode class=\"code\"\u003e@Getter\u003c/code\u003eと\u003ccode class=\"code\"\u003e@Action\u003c/code\u003eも用意しており使い勝手は全て同じです。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e引数|マップされる先\n---|---|---\n@State\u0026#x3C;T\u003e(key: keyof T, namespace?: string | undefined)| computed\n@Mutation\u0026#x3C;T\u003e(key: keyof T, namespace?: string | undefined)| methods\n@Getter\u0026#x3C;T\u003e(key: keyof T, namespace?: string | undefined)| computed\n@Actions\u0026#x3C;T\u003e(key: keyof T, namespace?: string | undefined)| methods\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eデコレータの第一引数は\u003ccode class=\"code\"\u003e\u0026#x3C;T\u003e(keyof T)\u003c/code\u003eとなっているため、\n型引数\u003ccode class=\"code\"\u003e\u0026#x3C;T\u003e\u003c/code\u003eの型に存在しないキーを渡せないようになっています。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eデコレータをつけるプロパティの型については、\nこのままだと任意になってしまい微妙なので対応したいところですね。\n内容がライブラリと少し離れてしまうため別の記事にしたいと思います。\u003c/p\u003e\n\u003ch3 class=\"heading lv-3\"\u003eNamespaceを意識した使い方\u003c/h3\u003e\n\u003cp class=\"paragraph\"\u003e前述した内容では確かに型安全になりますが、あまりにも記述する内容が多すぎます。\nそこでNamespaceを意識した方法を用意していますので紹介します。(むしろこっちがメイン\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enamespace\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'vuex-map-decorators'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSampleState\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  count\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e state\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e SampleState \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  count\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e mutations \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e getters \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e actions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e ns \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enamespace\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\n  SampleState\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e mutations\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e getters\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e action\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'sample'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n@Component\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSample\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  @ns\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eState\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'count'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  count\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// ↓ これと同じ意味になります\u003c/span\u003e\n@\u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003eState\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eSampleState\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'count'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'sample'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 class=\"heading lv-4\"\u003e解説\u003c/h4\u003e\n\u003cp class=\"paragraph\"\u003e\u003ccode class=\"code\"\u003enamespace\u003c/code\u003e関数に\u003ccode class=\"code\"\u003estate\u003c/code\u003e, \u003ccode class=\"code\"\u003emutaions\u003c/code\u003e, \u003ccode class=\"code\"\u003egetters\u003c/code\u003e, \u003ccode class=\"code\"\u003eactions\u003c/code\u003eの順で型を渡して、\n引数には名前空間を文字列で渡します。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eもし「\u003ccode class=\"code\"\u003egetters\u003c/code\u003eはないんだよね」って時は、型に\u003ccode class=\"code\"\u003enever\u003c/code\u003eを渡してあげてください\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e ns \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enamespace\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\n  SampleState\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e mutations\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token builtin\"\u003enever\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e      \u003cspan class=\"token comment\"\u003e// 実装していない部分はneverで\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e action\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'sample'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\nns\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eGetter \u003cspan class=\"token comment\"\u003e// \u0026#x3C;- ここではエラーになる\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e型に\u003ccode class=\"code\"\u003enever\u003c/code\u003eを渡すことで、返却されるオブジェクトの型が変わり、\n参照そのものができなくなります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e ns1 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enamespace\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eA\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eB\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eC\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eD\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'sample'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e/*\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e  ns1 = {\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    State(k: keyof A){},\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    Mutation(k: keyof B){},\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    Getter(k: keyof C){},\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    Action(k: keyof D){},\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e  }\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e*/\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e ns2 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enamespace\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eA\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enever\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enever\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eD\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'sample'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e/*\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e  ns2 = {\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    State(k: keyof A){},\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    Action(k: keyof D){},\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e  }\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e*/\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 class=\"heading lv-4\"\u003e従来のVuexコンテキストを利用する場合\u003c/h4\u003e\n\u003cp class=\"paragraph\"\u003eデコレータを使わず\u003ccode class=\"code\"\u003ecommit\u003c/code\u003eや\u003ccode class=\"code\"\u003edispatch\u003c/code\u003eを利用する場合です。\nやはりどうしてもデコレータだけだと辛いこともあるかもしれないので、\n以下のような手段を用意しました\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMutations\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function-variable function\"\u003eincrement\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estate\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e State\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e ns \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enamespace\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eState\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'views/sample'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e key \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e ns\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eMutation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'increment'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ekey\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// views/sample/increment\u003c/span\u003e\n$store\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecommit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ekey\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e少し野暮ったいですが、文字リテラルでも型に守られるため\nこの手段を使うこともありかと思います。\nただし、Payloadの型までは現時点で推論できないため今後の課題です。\u003c/p\u003e\n\u003ch3 class=\"heading lv-3\"\u003e実装内容\u003c/h3\u003e\n\u003cp class=\"paragraph\"\u003e実装は１ファイルです。\nまずはデコレータを作成するところをみてみます\u003c/p\u003e\n\u003ch4 class=\"heading lv-4\"\u003eデコレータ作成部分\u003c/h4\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateVuexDecorator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  bindTo\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'computed'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e'methods'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  mapper\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e VuexMapper\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ekey\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ekeyof\u003c/span\u003e \u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e namesapce\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eundefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e VuexDecorator \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ekey\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!==\u003c/span\u003e \u003cspan class=\"token string\"\u003e'string'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"token function\"\u003eError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003ekey is not string: key=\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003ekey\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e, ns=\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003enamesapce\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e dec \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateDecorator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etarget\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e prop\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003etarget\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ebindTo\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        target\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ebindTo\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      target\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ebindTo\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eprop\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n        namesapce \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token function\"\u003emapper\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enamesapce\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ekey\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token function\"\u003emapper\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ekey\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ekey\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e VuexDecorator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    dec\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ekey \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e namesapce \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003enamesapce\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e/\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003ekey\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e key\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e dec\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e State \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateVuexDecorator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'computed'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e mapState\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e Mutation \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateVuexDecorator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'methods'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e mapMutations\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e Getter \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateVuexDecorator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'computed'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e mapGetters\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e Action \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateVuexDecorator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'methods'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e mapActions\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e\u003ccode class=\"code\"\u003ecreateVuexDecorator\u003c/code\u003eを呼ぶことでそれぞれのデコレータを作成しています。\u003c/p\u003e\n\u003ch5 class=\"heading lv-5\"\u003e引数\u003c/h5\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVuexMapper\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e mapState\n  \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e mapMutations\n  \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e mapGetters\n  \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e mapActions\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateVuexDecorator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  bindTo\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'computed'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token string\"\u003e'methods'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  mapper\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e VuexMapper\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003eどこに何でマッピングするかを定義します。\n\u003ccode class=\"code\"\u003eState\u003c/code\u003eの場合は「computedにmapState」でマッピングを行なっています。\n\u003ccode class=\"code\"\u003eVuexMapper\u003c/code\u003eはvuex標準の\u003ccode class=\"code\"\u003emapXXXX\u003c/code\u003eのどれかです。\u003c/p\u003e\n\u003ch5 class=\"heading lv-5\"\u003eデコレータの実装部分\u003c/h5\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e createDecorator\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e VueDecorator \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'vue-class-component'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVuexDecorator\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVueDecorator\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  key\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e/*\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e  中略\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e*/\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eunknown\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ekey\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ekeyof\u003c/span\u003e \u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e namesapce\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eundefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e VuexDecorator \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// 入力チェックは省略\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e dec \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateDecorator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etarget\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e prop\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003etarget\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ebindTo\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        target\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ebindTo\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      target\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ebindTo\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eprop\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n        namesapce \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token function\"\u003emapper\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enamesapce\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ekey\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token function\"\u003emapper\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ekey\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ekey\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e VuexDecorator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    dec\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ekey \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e namesapce \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003enamesapce\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e/\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003ekey\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e key\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e dec\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch5 class=\"heading lv-5\"\u003e戻り値\u003c/h5\u003e\n\u003cp class=\"paragraph\"\u003eVue公式の\u003ccode class=\"code\"\u003evue-class-component\u003c/code\u003e内の\u003ccode class=\"code\"\u003eVueDecorator\u003c/code\u003eを拡張しており、\n\u003cstrong\u003e従来のVuexコンテキストを利用する場合\u003c/strong\u003e内で説明した\u003ccode class=\"code\"\u003ekey\u003c/code\u003eを追加しています。\u003c/p\u003e\n\u003ch5 class=\"heading lv-5\"\u003e本体\u003c/h5\u003e\n\u003cp class=\"paragraph\"\u003eまずは受け取った型から引数を絞ります。\nここではVue公式の\u003ccode class=\"code\"\u003ecreateDecorator\u003c/code\u003eを利用することで実装がとてもシンプルになります。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e\u003ccode class=\"code\"\u003etarget\u003c/code\u003eはコンポーネントで、\u003ccode class=\"code\"\u003eprop\u003c/code\u003eはデコレータがついていたプロパティになり、\n\u003ccode class=\"code\"\u003etarget['computed' | 'methods']\u003c/code\u003eへ \u003ccode class=\"code\"\u003emapXXXX\u003c/code\u003eの結果を突っ込んでいく形で実装しています。\u003c/p\u003e\n\u003ch4 class=\"heading lv-4\"\u003e名前空間作成部分\u003c/h4\u003e\n\u003cp class=\"paragraph\"\u003eこの戻りの型定義が一番面白いところです！\nそしてなくても困らない部分です...:smile:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enamespace\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eS\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enever\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eM\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enever\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eG\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enever\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eA\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enever\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003en\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e DecoratorInterface\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eG\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eA\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function-variable function\"\u003eState\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ek\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ekeyof\u003c/span\u003e \u003cspan class=\"token constant\"\u003eS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003eState\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eS\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ek\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token function-variable function\"\u003eMutation\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ek\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ekeyof\u003c/span\u003e \u003cspan class=\"token constant\"\u003eM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003eMutation\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eM\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ek\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token function-variable function\"\u003eGetter\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ek\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ekeyof\u003c/span\u003e \u003cspan class=\"token constant\"\u003eG\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003eGetter\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eG\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ek\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token function-variable function\"\u003eAction\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ek\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ekeyof\u003c/span\u003e \u003cspan class=\"token constant\"\u003eA\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003eAction\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eA\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ek\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e見ての通り、先ほど作成したデコレータにnamespaceを渡し、オブジェクトに固めているだけです。\nこの際にデコレータの引数で名前空間を受け取れなくしています。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eここで戻り値の型となっている\u003ccode class=\"code\"\u003eDecoratorInterface\u003c/code\u003eの説明を行いましょう！\u003c/p\u003e\n\u003ch5 class=\"heading lv-5\"\u003e名前空間オブジェクトの型\u003c/h5\u003e\n\u003cp class=\"paragraph\"\u003e型定義は以下のようになっています。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIsNever\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eN\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token constant\"\u003eN\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003enever\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token string\"\u003e'T'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'F'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIfNotNever\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eR\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eF\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eR\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eIsNever\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDecoratorMaker\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ek\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ekeyof\u003c/span\u003e \u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e VuexDecorator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDecoratorInterface\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eG\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eA\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e IfNotNever\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e State\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e DecoratorMaker\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eS\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n  \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e IfNotNever\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e Mutation\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e DecoratorMaker\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eM\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n  \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e IfNotNever\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eG\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e Getter\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e DecoratorMaker\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eG\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n  \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e IfNotNever\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eA\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e Action\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e DecoratorMaker\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eA\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003eはい出ました。TypeScript型遊びの時間です。\u003c/p\u003e\n\u003ch6\u003eIsNever\u0026#x3C;N\u003e\u003c/h6\u003e\n\u003cp class=\"paragraph\"\u003eNがNeverかどうかを判定し,\nNがNeverの場合は\u003ccode class=\"code\"\u003e'T'\u003c/code\u003e、違う場合は\u003ccode class=\"code\"\u003e'F'\u003c/code\u003eを返却します。\nちなみにここでいう\u003ccode class=\"code\"\u003e'T'\u003c/code\u003eは値ではなく\u003ccode class=\"code\"\u003e'T'\u003c/code\u003eという型です。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eここで\u003ccode class=\"code\"\u003e[never]\u003c/code\u003eのように配列にしなかった場合、うまくいきませんでした。\nハマったので調べてみるとTypeScript本家のIssueに書いてあってのでなんとか解決。\n\u003ca href=\"https://github.com/Microsoft/TypeScript/issues/23182\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\"\u003ehttps://github.com/Microsoft/TypeScript/issues/23182\u003c/a\u003e\u003c/p\u003e\n\u003ch6\u003eIfNotNever\u0026#x3C;T, R\u003e\u003c/h6\u003e\n\u003cp class=\"paragraph\"\u003e先ほど定義した\u003ccode class=\"code\"\u003eIsNever\u003c/code\u003eを利用します。\nもし\u003ccode class=\"code\"\u003eT\u003c/code\u003eがneverだった場合は空オブジェクトを、違う場合は\u003ccode class=\"code\"\u003eR\u003c/code\u003eを返却します。\nこうすることで、neverじゃない場合のみ、プロパティが参照できるようになります。\u003c/p\u003e\n\u003ch2 class=\"heading lv-2\"\u003eあとがき\u003c/h2\u003e\n\u003cp class=\"paragraph\"\u003e自分で作ったので当然ですが、\nなかなか使い勝手がいい感じに仕上がりました。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e実際に使い込んでみて都合が悪いことがあれば都度直していきたいと思います。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eやっぱりTypeScriptの型でモニョモニョするのは楽しいですね:relaxed:\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eおしまい\u003c/p\u003e"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"vuex_typesafe_library"},"buildId":"2TeC_BqFkmcRD1K9YUrqZ","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-51ce6eb9ed73aacaf515.js"></script><script src="/_next/static/chunks/main-8741ed3c7ec57f378f59.js" async=""></script><script src="/_next/static/chunks/webpack-95c2b224bccf352ee870.js" async=""></script><script src="/_next/static/chunks/framework.daa7383ad2ab2e6757c1.js" async=""></script><script src="/_next/static/chunks/commons.286c5ad94e4334e87283.js" async=""></script><script src="/_next/static/chunks/pages/_app-62c4ae74494db6a57e9e.js" async=""></script><script src="/_next/static/chunks/79afb1f29f0e22fb2195c114356294f95861ebcc.293ad4049eec03f4e065.js" async=""></script><script src="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.26412b03d1df03d45396.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-d84c8237cab24ecd19e3.js" async=""></script><script src="/_next/static/2TeC_BqFkmcRD1K9YUrqZ/_buildManifest.js" async=""></script><script src="/_next/static/2TeC_BqFkmcRD1K9YUrqZ/_ssgManifest.js" async=""></script></body></html>