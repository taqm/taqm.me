<!DOCTYPE html><html lang="ja"><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-X38HKLJWTQ"></script><script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-X38HKLJWTQ', { page_path: window.location.pathname, }); </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="robots" content="nofollow noindex"/><title>vue-routerを無理やりTypeScriptで型安全にする | taqm&#x27;s blog</title><meta name="keywords" content="Vue,TypeScript"/><meta name="description" content="TypeScriptでVue-routerを使う際に可能な限り方安全にするためのtipsです。"/><meta property="og:url" content="https://taqm.me/posts/vue_router_typesafe_tips"/><meta property="og:type" content="article"/><meta property="og:title" content="vue-routerを無理やりTypeScriptで型安全にする | taqm&amp;apos;s blog"/><meta property="og:image" content="https://taqm.me/static/site_logo.png"/><meta property="og:description" content="TypeScriptでVue-routerを使う際に可能な限り方安全にするためのtipsです。"/><meta property="og:site_name" content="taqm.me"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="taqm"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/3bd3ee853585bdba2b55.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3bd3ee853585bdba2b55.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-8741ed3c7ec57f378f59.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-95c2b224bccf352ee870.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.daa7383ad2ab2e6757c1.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.286c5ad94e4334e87283.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-62c4ae74494db6a57e9e.js" as="script"/><link rel="preload" href="/_next/static/chunks/79afb1f29f0e22fb2195c114356294f95861ebcc.293ad4049eec03f4e065.js" as="script"/><link rel="preload" href="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.26412b03d1df03d45396.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-d84c8237cab24ecd19e3.js" as="script"/><style id="__jsx-2615209551">.inner.jsx-2615209551{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:2.5rem;}@media (min-width:640px){.inner.jsx-2615209551{-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;height:4rem;padding-left:1.5rem;padding-right:1.5rem;}}</style></head><body><div id="__next"><header class="jsx-2615209551 border-b border-gray-200 bg-white"><div class="jsx-2615209551 inner max-w-screen-lg mx-auto"><a class="jsx-2615209551 text-xl sm:text-2xl" href="/">taqm&#x27;blog</a></div></header><main class="container py-16"><article class="post-page"><div class="text-sm text-gray-500">2018-11-07</div><h1 class="text-2xl font-bold">vue-routerを無理やりTypeScriptで型安全にする</h1><ul class="flex flex-wrap mt-2"><li class="mr-2 bg-gray-200 hover:bg-gray-300"><a class="block px-2 h-full text-sm" href="/tags/Vue">Vue</a></li><li class="mr-2 bg-gray-200 hover:bg-gray-300"><a class="block px-2 h-full text-sm" href="/tags/TypeScript">TypeScript</a></li></ul><div class="mt-10"><p class="paragraph">vue-routerをTypeScriptで使うと
どうも型安全じゃないのが気になります。</p>
<div class="remark-highlight"><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'ここになんでも入っちゃう！'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  query<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'ここにもなんでも入っちゃう！！'</span><span class="token operator">:</span> <span class="token string">'hogehoge'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p class="paragraph">そこですこし無理やりですがVueRouterを拡張して
いい感じになるようにしてみました。</p>
<h2 class="heading lv-2">ゴール</h2>
<p class="paragraph">少し長くなるので最終的にどうなるかを先に書いちゃいます。
今回の目的はライブラリの作成ではなく、
スニペットの作成だと思っていただけると良いです。</p>
<div class="remark-highlight"><pre class="language-ts pre"><code class="language-ts code"><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">pushTo</span><span class="token punctuation">(</span>RouteNames<span class="token punctuation">.</span>Detail<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  params<span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'sample'</span><span class="token punctuation">,</span>
    hoge<span class="token operator">:</span> <span class="token string">'fuga'</span><span class="token punctuation">,</span> <span class="token comment">// 定義していないparamsはエラー</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">pushTo</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// もちろん 定義したenumじゃないとエラー</span>
</code></pre></div>
<p class="paragraph">新しいメソッドをVueRouterに実装します。
第１引数に<code class="code">enum</code>を渡し、
第２引数には<strong>第１引数に応じたパラメータ</strong>しか渡せないようになっています。</p>
<p class="paragraph">ソースコードは<a href="https://github.com/taqm/typesafe-vue-router-sample" class="anchor" rel="noopener noreferrer" target="_blank">こちら(GitHub)</a></p>
<h2 class="heading lv-2">解説！</h2>
<h3 class="heading lv-3">ディレクトリ構造</h3>
<p class="paragraph">ディレクトリ構成は以下のような状況です。
トップ画面 → 検索結果画面 → 詳細画面
といったありがちなルーティングをサンプルとして扱っていきます。</p>
<div class="remark-highlight"><pre class="language-unknown pre"><code class="language-unknown code">├── App.vue
├── main.ts
├── router
│   ├── extension.ts
│   ├── index.ts
│   └── route.types.ts
└── views
    ├── DetailPage.vue
    ├── IndexPage.vue
    └── ListPage.vue</code></pre></div>
<p class="paragraph">他にもいろいろ必要なのですが今回は省略しています。
一応<code class="code">App.vue</code>と<code class="code">main.ts</code>の中身を先に紹介しますが
最小限になっていますので無視していただいても大丈夫です。</p>
<div class="has-filename"><div class="filename">./main.ts</div><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> h <span class="token operator">=></span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div>
<div class="has-filename"><div class="filename">./App.vue</div><pre class="language-vue pre"><code class="language-vue code">&#x26;lt;template&#x26;gt;
  &#x26;lt;div&#x26;gt;
    &#x26;lt;router-view/&#x26;gt;
  &#x26;lt;/div&#x26;gt;
&#x26;lt;/template&#x26;gt;</code></pre></div>
<p class="paragraph"><code class="code">main.ts</code>について１つだけ補足</p>
<div class="remark-highlight"><pre class="language-ts pre"><code class="language-ts code"><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span><span class="token punctuation">;</span>
</code></pre></div>
<p class="paragraph">知っている人も多いかと思いますが、
<code class="code">from</code> でディレクトリを指定することで、<code class="code">index.ts</code>が読み込まれます。
特に今回重要な要素ではないので特に触れません。</p>
<h3 class="heading lv-3">VueRouterを拡張</h3>
<p class="paragraph">型が曖昧なライブラリ群を型安全にするためには以下の方法が考えられます。</p>
<ol class="list ordered">
<li>ラッパークラス(モジュール)を作成する</li>
<li>本体を拡張する</li>
</ol>
<p class="paragraph">今回は「2. 本体を拡張する」を選択しました。</p>
<h4 class="heading lv-4">ルーティングの定義</h4>
<p class="paragraph">まずは型安全にするために、各ルーティングを定義していきましょう！
今回は</p>
<ul class="list unordered">
<li>Index</li>
<li>List</li>
<li>Detail</li>
</ul>
<p class="paragraph">といった3つの画面を作成します。
<code class="code">List</code>に行くためには検索ワード<code class="code">keyword</code>を。
<code class="code">Detail</code>に行くためには<code class="code">id</code>を渡す想定としましょう。</p>
<div class="has-filename"><div class="filename">./router/route.types.ts</div><pre class="language-ts pre"><code class="language-ts code"><span class="token keyword">export</span> <span class="token keyword">enum</span> RouteNames <span class="token punctuation">{</span>
  <span class="token constant">INDEX</span> <span class="token operator">=</span> <span class="token string">'index'</span><span class="token punctuation">,</span>
  <span class="token constant">LIST</span> <span class="token operator">=</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
  <span class="token constant">DETAIL</span> <span class="token operator">=</span> <span class="token string">'detail'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">StrRecord</span> <span class="token operator">=</span> Record<span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span>
<span class="token keyword">type</span> <span class="token class-name">Query<span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token keyword">extends</span> StrRecord<span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">{</span> query<span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Params<span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token keyword">extends</span> StrRecord<span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">{</span> params<span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ListOption</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  Query<span class="token operator">&#x3C;</span><span class="token punctuation">{</span> keyword<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">DetailOption</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  Params<span class="token operator">&#x3C;</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">RouteOption</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  ［RouteNames<span class="token punctuation">.</span><span class="token constant">INDEX</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  ［RouteNames<span class="token punctuation">.</span><span class="token constant">LIST</span><span class="token punctuation">]</span><span class="token operator">:</span> ListOption<span class="token punctuation">,</span>
  ［RouteNames<span class="token punctuation">.</span><span class="token constant">DETAIL</span><span class="token punctuation">]</span><span class="token operator">:</span> DetailOption<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p class="paragraph">各画面を<code class="code">enum RouteNames</code>として定義しますが
後に<code class="code">router</code>の<code class="code">name</code>に指定するので文字列にすることが必須。</p>
<p class="paragraph"><code class="code">RouteOption</code>にて各画面遷移時にどういったパラメータが必要なのかを関連付けます。
（Indexなどパラメータがない場合は空にしています)</p>
<p class="paragraph">画面遷移時に渡すものの標準として<code class="code">Query</code>と<code class="code">Params</code>を定義していますが、
もし<code class="code">hash</code>なども渡したい場合は同じ要領でtypeを定義してください。</p>
<p class="paragraph">この<code class="code">Query</code>などは<code class="code">this.$route.xxxx</code>とアクセスするときのIFなので
正しく定義する必要がある点が注意するポイントです。</p>
<p class="paragraph">あえて説明は不要かもしれませんが、
<code class="code">Query</code>と<code class="code">Params</code>をそれぞれ送りたい！と言った場合には以下のようにすると良いです。</p>
<div class="remark-highlight"><pre class="language-ts pre"><code class="language-ts code"><span class="token keyword">type</span> <span class="token class-name">SampleOption</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token operator">&#x26;</span> Query<span class="token operator">&#x3C;</span><span class="token punctuation">{</span> hoge<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token operator">&#x26;</span> Params<span class="token operator">&#x3C;</span><span class="token punctuation">{</span> fuga<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h4 class="heading lv-4">VueRouterの拡張</h4>
<p class="paragraph">前項で定義したルーティング定義を用いて
VueRouterそのものを拡張していきます。</p>
<h5 class="heading lv-5">定義の拡張</h5>
<div class="has-filename"><div class="filename">./router/extension.ts</div><pre class="language-ts pre"><code class="language-ts code"><span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> RouteOption <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./route.types'</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'vue-router/types/router'</span> <span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">VueRouter</span> <span class="token punctuation">{</span>
    <span class="token generic-function"><span class="token function">pushTo</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> RouteOption<span class="token operator">></span></span></span><span class="token punctuation">(</span>to<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> option<span class="token operator">:</span> RouteOption<span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p class="paragraph">この定義で<code class="code">VueRouter</code>の型定義へメソッドを追加します。
メソッド名は<code class="code">pushTo</code>としており</p>
<ul class="list unordered">
<li>第１引数は 遷移先</li>
<li>第２引数は 遷移先が求めるパラメータ</li>
</ul>
<p class="paragraph">となります。
第一引数の値の型(<code class="code">enum</code>)からRouteOptionへ参照させていますが
RouteOptionのキーは<code class="code">RouteNames</code>なので、
呼び出し時は</p>
<div class="remark-highlight"><pre class="language-ts pre"><code class="language-ts code"><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">pushTo</span><span class="token punctuation">(</span>RouteNames<span class="token punctuation">.</span>List<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token comment">/* */</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p class="paragraph">といったように記述することができます。</p>
<p class="paragraph">そして、第２引数は<code class="code">RouteOption</code>で定義した
<code class="code">Query</code>や<code class="code">Params</code>のオブジェクトしか受け付けないようになっており
遷移時に誤ったパラメータを渡すことを防ぎます！</p>
<h5 class="heading lv-5">定義の実装</h5>
<p class="paragraph">前項で定義したメソッドを実際に実装します。</p>
<div class="has-filename"><div class="filename">./router/extension.ts</div><pre class="language-ts pre"><code class="language-ts code"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">enhance</span><span class="token punctuation">(</span>router<span class="token operator">:</span> VueRouter<span class="token punctuation">)</span><span class="token operator">:</span> VueRouter <span class="token punctuation">{</span>
  router<span class="token punctuation">.</span><span class="token function-variable function">pushTo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">&#x3C;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> RouteOption<span class="token operator">></span><span class="token punctuation">(</span>
    to<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
    option<span class="token operator">:</span> RouteOption<span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token operator">:</span> to<span class="token punctuation">,</span>
        <span class="token operator">...</span><span class="token punctuation">(</span>option <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'エラー発生'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> router<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p class="paragraph">この<code class="code">enhance</code>関数へ、<code class="code">VueRouter</code>のインスタンスを渡し、
拡張する作りとなっています。</p>
<p class="paragraph">この関数の中でメソッドを実装しましょう。
一言で言うと<code class="code">pushTo</code>メソッドは、本家の<code class="code">push</code>メソッドのラップメソッドです。</p>
<p class="paragraph">第一引数を<code class="code">push</code>のnameへ。
その他はそのままオプションとして追加しております。
<code class="code">RouteOption[T]</code>だと<code class="code">push</code>の引数に与えられないので
ここは素直に<code class="code">any</code>にすることで解決しました。(これは仕方ないはず！)</p>
<h7>課題</h7>
<p class="paragraph">ここで課題として残ったことが、<code class="code">Index</code>など
パラメータを必要としないものかどうかを判定して、
メソッドの引数を<code class="code">Optional</code>にできなかった点です。</p>
<p class="paragraph">そのため<code class="code">Index</code>へ遷移する際は、第２引数に空オブジェクトを渡す必要があります:frowning2:
悔しいですが今後の課題としてここは前に進みました。</p>
<h3 class="heading lv-3">ルーティングの実装</h3>
<p class="paragraph">ほぼ基本通りの作りになります</p>
<div class="has-filename"><div class="filename">./router/index.ts</div><pre class="language-ts pre"><code class="language-ts code"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'vue-router'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> RouteNames <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./route.types'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> enhance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./extension'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> IndexPage <span class="token keyword">from</span> <span class="token string">'../views/IndexPage.vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ListPage <span class="token keyword">from</span> <span class="token string">'../views/ListPage.vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> DetailPage <span class="token keyword">from</span> <span class="token string">'../views/DetailPage.vue'</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'history'</span><span class="token punctuation">,</span>
  base<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BASE_URL</span><span class="token punctuation">,</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> RouteNames<span class="token punctuation">.</span><span class="token constant">INDEX</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> IndexPage<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/items'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> RouteNames<span class="token punctuation">.</span><span class="token constant">LIST</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> ListPage<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/items/:id'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> RouteNames<span class="token punctuation">.</span><span class="token constant">DETAIL</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> DetailPage<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">enhance</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p class="paragraph">一つだけ絶対に忘れてはいけないことあります。
exportする前に先ほど作成した<code class="code">enhance</code>関数を呼び出して、
routerを拡張した状態で外部へ提供しましょう。</p>
<h3 class="heading lv-3">実際にコンポーネントから使ってみる</h3>
<div class="has-filename"><div class="filename">./views/IndexPage.vue</div><pre class="language-vuejs pre"><code class="language-vuejs code">&#x26;lt;template&#x26;gt;
  &#x26;lt;form @submit.prevent=&#x26;quot;onSubmit&#x26;quot;&#x26;gt;
    &#x26;lt;input v-model=&#x26;quot;keyword&#x26;quot; required&#x26;gt;
    &#x26;lt;input type=&#x26;quot;submit&#x26;quot; value=&#x26;quot;送信&#x26;quot;&#x26;gt;
  &#x26;lt;/form&#x26;gt;
&#x26;lt;/template&#x26;gt;

&#x26;lt;script lang=&#x26;quot;ts&#x26;quot;&#x26;gt;
import Vue from &#x26;#39;vue&#x26;#39;
import { RouteNames } from &#x26;#39;@/router/route.types&#x26;#39;;

export default Vue.extend({
  data() {
    return {
      keyword: &#x26;#39;&#x26;#39;,
    };
  },
  methods: {
    onSubmit() {
      this.$router.pushTo(RouteNames.LIST, {
        query: {
          keyword: this.keyword,
        },
      });
    },
  },
});
&#x26;lt;/script&#x26;gt;</code></pre></div>
<p class="paragraph"><code class="code">methods</code>内の<code class="code">onSubmit</code>で今回実装した<code class="code">puthTo</code>を使っています。
<code class="code">RouteNAmes.LIST</code>へ遷移するためには、<code class="code">keyword</code>が必要なので
第２引数ではこの形のオブジェクトを渡すことを強制しています。</p>
<p class="paragraph">実際に動くサンプルをGitHubへ上げているので
他の画面については割愛させてもらいます。
<a href="https://github.com/taqm/typesafe-vue-router-sample" class="anchor" rel="noopener noreferrer" target="_blank">サンプル</a></p>
<h2 class="heading lv-2">残った課題</h2>
<p class="paragraph">今回モジュールの拡張を行ってみましたが、
大きく２つの課題が残りました。</p>
<p class="paragraph">上でも書いたのですが、
<strong>パラメータを必要としないルーティングには空オブジェクトを渡す必要がある</strong>
です。まあ野暮ったいだけで実害はあまりないのでよいです。</p>
<p class="paragraph">もう一つが<strong>パラメータを利用する側が型に守られない</strong>ことです。</p>
<p class="paragraph">遷移先のコンポーネントでは以下のようにして値を取る必要があります。</p>
<div class="remark-highlight"><pre class="language-ts pre"><code class="language-ts code">computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">keyword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> option<span class="token operator">:</span> ListOption <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> option<span class="token punctuation">.</span>query<span class="token punctuation">.</span>keyword<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div>
<p class="paragraph">各コンポーネントに<code class="code">any</code>が入ってくるのはとてもつらいです
今の所「これだ！！！」という解決策は見つかっていないので
どこかでちゃんと対策してみたいです。</p>
<h2 class="heading lv-2">最後に</h2>
<p class="paragraph">今回やってみた内容は実際に業務でも使ってみました。
実際に使ってみるとルーティング周りのミスはかなり減りました。
やはり型に縛られるのは気持ちいですね:relaxed:</p>
<p class="paragraph">ただし、こういった拡張を乱発しすぎると
なにか起きたときに問題の切り分けなどが難しくなりかねないので
ほどほどにしましょう。</p>
<hr>
<p class="paragraph">おしまい</p></div></article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":"{\"slug\":\"vue_router_typesafe_tips\",\"title\":\"vue-routerを無理やりTypeScriptで型安全にする\",\"publishedAt\":\"2018-11-07T05:13:53.000Z\",\"description\":\"TypeScriptでVue-routerを使う際に可能な限り方安全にするためのtipsです。\",\"tags\":[\"Vue\",\"TypeScript\"]}","content":"\u003cp class=\"paragraph\"\u003evue-routerをTypeScriptで使うと\nどうも型安全じゃないのが気になります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e$router\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'ここになんでも入っちゃう！'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  query\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e'ここにもなんでも入っちゃう！！'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'hogehoge'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003eそこですこし無理やりですがVueRouterを拡張して\nいい感じになるようにしてみました。\u003c/p\u003e\n\u003ch2 class=\"heading lv-2\"\u003eゴール\u003c/h2\u003e\n\u003cp class=\"paragraph\"\u003e少し長くなるので最終的にどうなるかを先に書いちゃいます。\n今回の目的はライブラリの作成ではなく、\nスニペットの作成だと思っていただけると良いです。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-ts pre\"\u003e\u003ccode class=\"language-ts code\"\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e$router\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epushTo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eRouteNames\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDetail\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  params\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    id\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'sample'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    hoge\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fuga'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// 定義していないparamsはエラー\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e$router\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epushTo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'test'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// もちろん 定義したenumじゃないとエラー\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e新しいメソッドをVueRouterに実装します。\n第１引数に\u003ccode class=\"code\"\u003eenum\u003c/code\u003eを渡し、\n第２引数には\u003cstrong\u003e第１引数に応じたパラメータ\u003c/strong\u003eしか渡せないようになっています。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eソースコードは\u003ca href=\"https://github.com/taqm/typesafe-vue-router-sample\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\"\u003eこちら(GitHub)\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading lv-2\"\u003e解説！\u003c/h2\u003e\n\u003ch3 class=\"heading lv-3\"\u003eディレクトリ構造\u003c/h3\u003e\n\u003cp class=\"paragraph\"\u003eディレクトリ構成は以下のような状況です。\nトップ画面 → 検索結果画面 → 詳細画面\nといったありがちなルーティングをサンプルとして扱っていきます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown pre\"\u003e\u003ccode class=\"language-unknown code\"\u003e├── App.vue\n├── main.ts\n├── router\n│   ├── extension.ts\n│   ├── index.ts\n│   └── route.types.ts\n└── views\n    ├── DetailPage.vue\n    ├── IndexPage.vue\n    └── ListPage.vue\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e他にもいろいろ必要なのですが今回は省略しています。\n一応\u003ccode class=\"code\"\u003eApp.vue\u003c/code\u003eと\u003ccode class=\"code\"\u003emain.ts\u003c/code\u003eの中身を先に紹介しますが\n最小限になっていますので無視していただいても大丈夫です。\u003c/p\u003e\n\u003cdiv class=\"has-filename\"\u003e\u003cdiv class=\"filename\"\u003e./main.ts\u003c/div\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e Vue \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'vue'\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e App \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'./App.vue'\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e router \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'./router'\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  router\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token function-variable function\"\u003erender\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e h \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eh\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eApp\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003e$mount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'#app'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"has-filename\"\u003e\u003cdiv class=\"filename\"\u003e./App.vue\u003c/div\u003e\u003cpre class=\"language-vue pre\"\u003e\u003ccode class=\"language-vue code\"\u003e\u0026#x26;lt;template\u0026#x26;gt;\n  \u0026#x26;lt;div\u0026#x26;gt;\n    \u0026#x26;lt;router-view/\u0026#x26;gt;\n  \u0026#x26;lt;/div\u0026#x26;gt;\n\u0026#x26;lt;/template\u0026#x26;gt;\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e\u003ccode class=\"code\"\u003emain.ts\u003c/code\u003eについて１つだけ補足\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-ts pre\"\u003e\u003ccode class=\"language-ts code\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e router \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'./router'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e知っている人も多いかと思いますが、\n\u003ccode class=\"code\"\u003efrom\u003c/code\u003e でディレクトリを指定することで、\u003ccode class=\"code\"\u003eindex.ts\u003c/code\u003eが読み込まれます。\n特に今回重要な要素ではないので特に触れません。\u003c/p\u003e\n\u003ch3 class=\"heading lv-3\"\u003eVueRouterを拡張\u003c/h3\u003e\n\u003cp class=\"paragraph\"\u003e型が曖昧なライブラリ群を型安全にするためには以下の方法が考えられます。\u003c/p\u003e\n\u003col class=\"list ordered\"\u003e\n\u003cli\u003eラッパークラス(モジュール)を作成する\u003c/li\u003e\n\u003cli\u003e本体を拡張する\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp class=\"paragraph\"\u003e今回は「2. 本体を拡張する」を選択しました。\u003c/p\u003e\n\u003ch4 class=\"heading lv-4\"\u003eルーティングの定義\u003c/h4\u003e\n\u003cp class=\"paragraph\"\u003eまずは型安全にするために、各ルーティングを定義していきましょう！\n今回は\u003c/p\u003e\n\u003cul class=\"list unordered\"\u003e\n\u003cli\u003eIndex\u003c/li\u003e\n\u003cli\u003eList\u003c/li\u003e\n\u003cli\u003eDetail\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"paragraph\"\u003eといった3つの画面を作成します。\n\u003ccode class=\"code\"\u003eList\u003c/code\u003eに行くためには検索ワード\u003ccode class=\"code\"\u003ekeyword\u003c/code\u003eを。\n\u003ccode class=\"code\"\u003eDetail\u003c/code\u003eに行くためには\u003ccode class=\"code\"\u003eid\u003c/code\u003eを渡す想定としましょう。\u003c/p\u003e\n\u003cdiv class=\"has-filename\"\u003e\u003cdiv class=\"filename\"\u003e./router/route.types.ts\u003c/div\u003e\u003cpre class=\"language-ts pre\"\u003e\u003ccode class=\"language-ts code\"\u003e\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eenum\u003c/span\u003e RouteNames \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eINDEX\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'index'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eLIST\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'list'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eDETAIL\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'detail'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eStrRecord\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Record\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eany\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eQuery\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eextends\u003c/span\u003e StrRecord\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e query\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eT\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eParams\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eextends\u003c/span\u003e StrRecord\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e params\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eT\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eListOption\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  Query\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e keyword\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDetailOption\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  Params\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e id\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eRouteOption\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  ［RouteNames\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eINDEX\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  ［RouteNames\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eLIST\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e ListOption\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  ［RouteNames\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eDETAIL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e DetailOption\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e各画面を\u003ccode class=\"code\"\u003eenum RouteNames\u003c/code\u003eとして定義しますが\n後に\u003ccode class=\"code\"\u003erouter\u003c/code\u003eの\u003ccode class=\"code\"\u003ename\u003c/code\u003eに指定するので文字列にすることが必須。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e\u003ccode class=\"code\"\u003eRouteOption\u003c/code\u003eにて各画面遷移時にどういったパラメータが必要なのかを関連付けます。\n（Indexなどパラメータがない場合は空にしています)\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e画面遷移時に渡すものの標準として\u003ccode class=\"code\"\u003eQuery\u003c/code\u003eと\u003ccode class=\"code\"\u003eParams\u003c/code\u003eを定義していますが、\nもし\u003ccode class=\"code\"\u003ehash\u003c/code\u003eなども渡したい場合は同じ要領でtypeを定義してください。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eこの\u003ccode class=\"code\"\u003eQuery\u003c/code\u003eなどは\u003ccode class=\"code\"\u003ethis.$route.xxxx\u003c/code\u003eとアクセスするときのIFなので\n正しく定義する必要がある点が注意するポイントです。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eあえて説明は不要かもしれませんが、\n\u003ccode class=\"code\"\u003eQuery\u003c/code\u003eと\u003ccode class=\"code\"\u003eParams\u003c/code\u003eをそれぞれ送りたい！と言った場合には以下のようにすると良いです。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-ts pre\"\u003e\u003ccode class=\"language-ts code\"\u003e\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSampleOption\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e Query\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e hoge\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n  \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e Params\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e fuga\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eboolean\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 class=\"heading lv-4\"\u003eVueRouterの拡張\u003c/h4\u003e\n\u003cp class=\"paragraph\"\u003e前項で定義したルーティング定義を用いて\nVueRouterそのものを拡張していきます。\u003c/p\u003e\n\u003ch5 class=\"heading lv-5\"\u003e定義の拡張\u003c/h5\u003e\n\u003cdiv class=\"has-filename\"\u003e\u003cdiv class=\"filename\"\u003e./router/extension.ts\u003c/div\u003e\u003cpre class=\"language-ts pre\"\u003e\u003ccode class=\"language-ts code\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e VueRouter \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'vue-router'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e RouteOption \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'./route.types'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003edeclare\u003c/span\u003e \u003cspan class=\"token keyword\"\u003emodule\u003c/span\u003e \u003cspan class=\"token string\"\u003e'vue-router/types/router'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVueRouter\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003epushTo\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ekeyof\u003c/span\u003e RouteOption\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eto\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e option\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e RouteOption\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003eこの定義で\u003ccode class=\"code\"\u003eVueRouter\u003c/code\u003eの型定義へメソッドを追加します。\nメソッド名は\u003ccode class=\"code\"\u003epushTo\u003c/code\u003eとしており\u003c/p\u003e\n\u003cul class=\"list unordered\"\u003e\n\u003cli\u003e第１引数は 遷移先\u003c/li\u003e\n\u003cli\u003e第２引数は 遷移先が求めるパラメータ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"paragraph\"\u003eとなります。\n第一引数の値の型(\u003ccode class=\"code\"\u003eenum\u003c/code\u003e)からRouteOptionへ参照させていますが\nRouteOptionのキーは\u003ccode class=\"code\"\u003eRouteNames\u003c/code\u003eなので、\n呼び出し時は\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-ts pre\"\u003e\u003ccode class=\"language-ts code\"\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e$router\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epushTo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eRouteNames\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eList\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token comment\"\u003e/* */\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003eといったように記述することができます。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eそして、第２引数は\u003ccode class=\"code\"\u003eRouteOption\u003c/code\u003eで定義した\n\u003ccode class=\"code\"\u003eQuery\u003c/code\u003eや\u003ccode class=\"code\"\u003eParams\u003c/code\u003eのオブジェクトしか受け付けないようになっており\n遷移時に誤ったパラメータを渡すことを防ぎます！\u003c/p\u003e\n\u003ch5 class=\"heading lv-5\"\u003e定義の実装\u003c/h5\u003e\n\u003cp class=\"paragraph\"\u003e前項で定義したメソッドを実際に実装します。\u003c/p\u003e\n\u003cdiv class=\"has-filename\"\u003e\u003cdiv class=\"filename\"\u003e./router/extension.ts\u003c/div\u003e\u003cpre class=\"language-ts pre\"\u003e\u003ccode class=\"language-ts code\"\u003e\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eenhance\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erouter\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e VueRouter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e VueRouter \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  router\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function-variable function\"\u003epushTo\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ekeyof\u003c/span\u003e RouteOption\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    to\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    option\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e RouteOption\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token constant\"\u003eT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token builtin\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresolve\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e reject\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e to\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoption \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eany\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e resolve\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e reject\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ecatch\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token builtin\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eerror\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'エラー発生'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e router\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003eこの\u003ccode class=\"code\"\u003eenhance\u003c/code\u003e関数へ、\u003ccode class=\"code\"\u003eVueRouter\u003c/code\u003eのインスタンスを渡し、\n拡張する作りとなっています。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eこの関数の中でメソッドを実装しましょう。\n一言で言うと\u003ccode class=\"code\"\u003epushTo\u003c/code\u003eメソッドは、本家の\u003ccode class=\"code\"\u003epush\u003c/code\u003eメソッドのラップメソッドです。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e第一引数を\u003ccode class=\"code\"\u003epush\u003c/code\u003eのnameへ。\nその他はそのままオプションとして追加しております。\n\u003ccode class=\"code\"\u003eRouteOption[T]\u003c/code\u003eだと\u003ccode class=\"code\"\u003epush\u003c/code\u003eの引数に与えられないので\nここは素直に\u003ccode class=\"code\"\u003eany\u003c/code\u003eにすることで解決しました。(これは仕方ないはず！)\u003c/p\u003e\n\u003ch7\u003e課題\u003c/h7\u003e\n\u003cp class=\"paragraph\"\u003eここで課題として残ったことが、\u003ccode class=\"code\"\u003eIndex\u003c/code\u003eなど\nパラメータを必要としないものかどうかを判定して、\nメソッドの引数を\u003ccode class=\"code\"\u003eOptional\u003c/code\u003eにできなかった点です。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eそのため\u003ccode class=\"code\"\u003eIndex\u003c/code\u003eへ遷移する際は、第２引数に空オブジェクトを渡す必要があります:frowning2:\n悔しいですが今後の課題としてここは前に進みました。\u003c/p\u003e\n\u003ch3 class=\"heading lv-3\"\u003eルーティングの実装\u003c/h3\u003e\n\u003cp class=\"paragraph\"\u003eほぼ基本通りの作りになります\u003c/p\u003e\n\u003cdiv class=\"has-filename\"\u003e\u003cdiv class=\"filename\"\u003e./router/index.ts\u003c/div\u003e\u003cpre class=\"language-ts pre\"\u003e\u003ccode class=\"language-ts code\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e Vue \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'vue'\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e Router \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'vue-router'\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e RouteNames \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'./route.types'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e enhance \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'./extension'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e IndexPage \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'../views/IndexPage.vue'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e ListPage \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'../views/ListPage.vue'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e DetailPage \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e'../views/DetailPage.vue'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\nVue\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003euse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eRouter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e router \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eRouter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  mode\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'history'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  base\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eenv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eBASE_URL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  routes\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      path\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'/'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e RouteNames\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eINDEX\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      component\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e IndexPage\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      path\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'/items'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e RouteNames\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eLIST\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      component\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e ListPage\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      path\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'/items/:id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e RouteNames\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eDETAIL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      component\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e DetailPage\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"token function\"\u003eenhance\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erouter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e一つだけ絶対に忘れてはいけないことあります。\nexportする前に先ほど作成した\u003ccode class=\"code\"\u003eenhance\u003c/code\u003e関数を呼び出して、\nrouterを拡張した状態で外部へ提供しましょう。\u003c/p\u003e\n\u003ch3 class=\"heading lv-3\"\u003e実際にコンポーネントから使ってみる\u003c/h3\u003e\n\u003cdiv class=\"has-filename\"\u003e\u003cdiv class=\"filename\"\u003e./views/IndexPage.vue\u003c/div\u003e\u003cpre class=\"language-vuejs pre\"\u003e\u003ccode class=\"language-vuejs code\"\u003e\u0026#x26;lt;template\u0026#x26;gt;\n  \u0026#x26;lt;form @submit.prevent=\u0026#x26;quot;onSubmit\u0026#x26;quot;\u0026#x26;gt;\n    \u0026#x26;lt;input v-model=\u0026#x26;quot;keyword\u0026#x26;quot; required\u0026#x26;gt;\n    \u0026#x26;lt;input type=\u0026#x26;quot;submit\u0026#x26;quot; value=\u0026#x26;quot;送信\u0026#x26;quot;\u0026#x26;gt;\n  \u0026#x26;lt;/form\u0026#x26;gt;\n\u0026#x26;lt;/template\u0026#x26;gt;\n\n\u0026#x26;lt;script lang=\u0026#x26;quot;ts\u0026#x26;quot;\u0026#x26;gt;\nimport Vue from \u0026#x26;#39;vue\u0026#x26;#39;\nimport { RouteNames } from \u0026#x26;#39;@/router/route.types\u0026#x26;#39;;\n\nexport default Vue.extend({\n  data() {\n    return {\n      keyword: \u0026#x26;#39;\u0026#x26;#39;,\n    };\n  },\n  methods: {\n    onSubmit() {\n      this.$router.pushTo(RouteNames.LIST, {\n        query: {\n          keyword: this.keyword,\n        },\n      });\n    },\n  },\n});\n\u0026#x26;lt;/script\u0026#x26;gt;\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e\u003ccode class=\"code\"\u003emethods\u003c/code\u003e内の\u003ccode class=\"code\"\u003eonSubmit\u003c/code\u003eで今回実装した\u003ccode class=\"code\"\u003eputhTo\u003c/code\u003eを使っています。\n\u003ccode class=\"code\"\u003eRouteNAmes.LIST\u003c/code\u003eへ遷移するためには、\u003ccode class=\"code\"\u003ekeyword\u003c/code\u003eが必要なので\n第２引数ではこの形のオブジェクトを渡すことを強制しています。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e実際に動くサンプルをGitHubへ上げているので\n他の画面については割愛させてもらいます。\n\u003ca href=\"https://github.com/taqm/typesafe-vue-router-sample\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\"\u003eサンプル\u003c/a\u003e\u003c/p\u003e\n\u003ch2 class=\"heading lv-2\"\u003e残った課題\u003c/h2\u003e\n\u003cp class=\"paragraph\"\u003e今回モジュールの拡張を行ってみましたが、\n大きく２つの課題が残りました。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e上でも書いたのですが、\n\u003cstrong\u003eパラメータを必要としないルーティングには空オブジェクトを渡す必要がある\u003c/strong\u003e\nです。まあ野暮ったいだけで実害はあまりないのでよいです。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eもう一つが\u003cstrong\u003eパラメータを利用する側が型に守られない\u003c/strong\u003eことです。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e遷移先のコンポーネントでは以下のようにして値を取る必要があります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-ts pre\"\u003e\u003ccode class=\"language-ts code\"\u003ecomputed\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003ekeyword\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e option\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e ListOption \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e$route \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eany\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e option\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003equery\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ekeyword\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e各コンポーネントに\u003ccode class=\"code\"\u003eany\u003c/code\u003eが入ってくるのはとてもつらいです\n今の所「これだ！！！」という解決策は見つかっていないので\nどこかでちゃんと対策してみたいです。\u003c/p\u003e\n\u003ch2 class=\"heading lv-2\"\u003e最後に\u003c/h2\u003e\n\u003cp class=\"paragraph\"\u003e今回やってみた内容は実際に業務でも使ってみました。\n実際に使ってみるとルーティング周りのミスはかなり減りました。\nやはり型に縛られるのは気持ちいですね:relaxed:\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eただし、こういった拡張を乱発しすぎると\nなにか起きたときに問題の切り分けなどが難しくなりかねないので\nほどほどにしましょう。\u003c/p\u003e\n\u003chr\u003e\n\u003cp class=\"paragraph\"\u003eおしまい\u003c/p\u003e"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"vue_router_typesafe_tips"},"buildId":"2TeC_BqFkmcRD1K9YUrqZ","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-51ce6eb9ed73aacaf515.js"></script><script src="/_next/static/chunks/main-8741ed3c7ec57f378f59.js" async=""></script><script src="/_next/static/chunks/webpack-95c2b224bccf352ee870.js" async=""></script><script src="/_next/static/chunks/framework.daa7383ad2ab2e6757c1.js" async=""></script><script src="/_next/static/chunks/commons.286c5ad94e4334e87283.js" async=""></script><script src="/_next/static/chunks/pages/_app-62c4ae74494db6a57e9e.js" async=""></script><script src="/_next/static/chunks/79afb1f29f0e22fb2195c114356294f95861ebcc.293ad4049eec03f4e065.js" async=""></script><script src="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.26412b03d1df03d45396.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-d84c8237cab24ecd19e3.js" async=""></script><script src="/_next/static/2TeC_BqFkmcRD1K9YUrqZ/_buildManifest.js" async=""></script><script src="/_next/static/2TeC_BqFkmcRD1K9YUrqZ/_ssgManifest.js" async=""></script></body></html>