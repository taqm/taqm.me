<!DOCTYPE html><html lang="ja"><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-X38HKLJWTQ"></script><script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-X38HKLJWTQ', { page_path: window.location.pathname, }); </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="robots" content="nofollow noindex"/><title>TypeScriptで Redux の Reducer部分を型安全かつスッキリ書く | taqm&#x27;s blog</title><meta name="keywords" content="Redux,TypeScript"/><meta name="description" content="TypeScriptのConditional Typesを利用してReduxの定義を完結に記述する解説です。"/><meta property="og:url" content="https://taqm.me/posts/simple_and_typesafe_redux_reducer"/><meta property="og:type" content="article"/><meta property="og:title" content="TypeScriptで Redux の Reducer部分を型安全かつスッキリ書く | taqm&amp;apos;s blog"/><meta property="og:image" content="https://taqm.me/static/site_logo.png"/><meta property="og:description" content="TypeScriptのConditional Typesを利用してReduxの定義を完結に記述する解説です。"/><meta property="og:site_name" content="taqm.me"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="taqm"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/3bd3ee853585bdba2b55.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3bd3ee853585bdba2b55.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-8741ed3c7ec57f378f59.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-95c2b224bccf352ee870.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.daa7383ad2ab2e6757c1.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.286c5ad94e4334e87283.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-62c4ae74494db6a57e9e.js" as="script"/><link rel="preload" href="/_next/static/chunks/79afb1f29f0e22fb2195c114356294f95861ebcc.293ad4049eec03f4e065.js" as="script"/><link rel="preload" href="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.26412b03d1df03d45396.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-d84c8237cab24ecd19e3.js" as="script"/><style id="__jsx-2615209551">.inner.jsx-2615209551{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:2.5rem;}@media (min-width:640px){.inner.jsx-2615209551{-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;height:4rem;padding-left:1.5rem;padding-right:1.5rem;}}</style></head><body><div id="__next"><header class="jsx-2615209551 border-b border-gray-200 bg-white"><div class="jsx-2615209551 inner max-w-screen-lg mx-auto"><a class="jsx-2615209551 text-xl sm:text-2xl" href="/">taqm&#x27;blog</a></div></header><main class="container py-16"><article class="post-page"><div class="text-sm text-gray-500">2018-05-08</div><h1 class="text-2xl font-bold">TypeScriptで Redux の Reducer部分を型安全かつスッキリ書く</h1><ul class="flex flex-wrap mt-2"><li class="mr-2 bg-gray-200 hover:bg-gray-300"><a class="block px-2 h-full text-sm" href="/tags/Redux">Redux</a></li><li class="mr-2 bg-gray-200 hover:bg-gray-300"><a class="block px-2 h-full text-sm" href="/tags/TypeScript">TypeScript</a></li></ul><div class="mt-10"><h2 class="heading lv-2">はじめに</h2>
<p class="paragraph">TypeScript 2.8がリリースされ色々な機能が追加されました。
その中でも<em>Conditional types</em>、特に<em>ReturnType</em>がなかなか優秀で
今まで諦めていた部分がきれいに書けるようになっております。</p>
<p class="paragraph">そこで個人的にずさんになりがちな、ReduxのReducer周りを少し改良してみたのでご紹介</p>
<h2 class="heading lv-2">コード</h2>
<div class="remark-highlight"><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">const</span> <span class="token constant">INCREMENT</span> <span class="token operator">=</span> <span class="token string">'app/example/INCREMENT'</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">SET_COUNT</span> <span class="token operator">=</span> <span class="token string">'app/example/SET_COUNT'</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">INCREMENT</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">setCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span>num<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token constant">SET_COUNT</span><span class="token punctuation">,</span>
  payload<span class="token operator">:</span> <span class="token punctuation">{</span>
    count<span class="token operator">:</span> num<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Actions</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token operator">|</span> ReturnType<span class="token operator">&#x3C;</span><span class="token keyword">typeof</span> increment<span class="token operator">></span>
  <span class="token operator">|</span> ReturnType<span class="token operator">&#x3C;</span><span class="token keyword">typeof</span> setCount<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">AppState</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 本記事の趣旨に関係ないため割愛</span>
<span class="token keyword">const</span> initialState<span class="token operator">:</span> AppState <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span>
  state<span class="token operator">:</span> AppState <span class="token operator">=</span> initialState<span class="token punctuation">,</span>
  action<span class="token operator">:</span> Actions<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">INCREMENT</span><span class="token operator">:</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// ↑ SET_COUNT以外でpayloadを参照するとエラーになる</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> <span class="token constant">SET_COUNT</span><span class="token operator">:</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// ↑ OK</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">const</span> _<span class="token operator">:</span> <span class="token builtin">never</span> <span class="token operator">=</span> action<span class="token punctuation">;</span>
      <span class="token comment">// ↑ ケースの定義もれがあった場合にエラーになる</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p class="paragraph">下で要点を解説していきます
また、今回は型をテーマにしていますので、
Reducerの処理自体は空っぽにしております</p>
<h4 class="heading lv-4">ReturnTypeの利用</h4>
<p class="paragraph">TypeScript2.8の機能であるReturnTypeを利用することで、
ActionCreator関数の戻り値からActionの型を特定することができるようになりました。
こうすることでAction型定義の管理が少しだけ楽になります。</p>
<div class="remark-highlight"><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">type</span> <span class="token class-name">Actions</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token operator">|</span> ReturnType<span class="token operator">&#x3C;</span><span class="token keyword">typeof</span> increment<span class="token operator">></span>
  <span class="token operator">|</span> ReturnType<span class="token operator">&#x3C;</span><span class="token keyword">typeof</span> setCount<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ↓ こう解釈される</span>

<span class="token keyword">type</span> <span class="token class-name">Actions</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">"app/example/INCREMENT"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">"app/example/SET_COUNT"</span><span class="token punctuation">;</span>
    payload<span class="token operator">:</span> <span class="token punctuation">{</span>
        count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p class="paragraph">TypeScript3.4で導入された <code class="code">const assertion</code> を利用することで各定数が<code class="code">string</code>ではなく、
その文字列の型として定義されるため↑のようにtypeが各アクションとして認識されます。</p>
<div class="remark-highlight"><pre class="language-typescript pre"><code class="language-typescript code"><span class="token keyword">const</span> <span class="token constant">INCREMENT</span> <span class="token operator">=</span> <span class="token string">'app/example/INCREMENT'</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">SET_COUNT</span> <span class="token operator">=</span> <span class="token string">'app/example/SET_COUNT'</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
</code></pre></div>
<h4 class="heading lv-4">defaultの部分</h4>
<p class="paragraph"><code class="code">default</code>部分の<code class="code">never</code>型への代入については<a href="https://qiita.com/wadahiro/items/9ec4af968a7314402499#_reference-ea5a7c38d951fc383cd3" class="anchor" rel="noopener noreferrer" target="_blank">TypeScript 2.0のneverでTagged union typesの絞込を漏れ無くチェックする</a> の記事で紹介されている素敵なテクニックです。</p>
<h2 class="heading lv-2">最後に</h2>
<p class="paragraph">TypeScriptではanyを多用すればエラーを黙らせることはできますが
いかにして型安全に設計・実装できるかを考えるのが楽しいですよね。</p>
<p class="paragraph">実はもっといい方法があるのではないかと
うずうずしていますので、いい案があればぜひ教えていただきたいです。</p>
<h2 class="heading lv-2">参考記事</h2>
<p class="paragraph">色々参考にさせていただきました。</p>
<ul class="list unordered">
<li><a href="https://qiita.com/wadahiro/items/7c421b668f28a99e2a29" class="anchor" rel="noopener noreferrer" target="_blank">Redux typed actions でReducerを型安全に書く (TypeScriptのバージョン別)</a></li>
<li><a href="https://qiita.com/wadahiro/items/9ec4af968a7314402499#_reference-ea5a7c38d951fc383cd3" class="anchor" rel="noopener noreferrer" target="_blank">TypeScript 2.0のneverでTagged union typesの絞込を漏れ無くチェックする</a></li>
<li>[真・Flow &#x26; Redux で Reducer の実装パターンを考える</li>
</ul>
<p class="paragraph">](<a href="https://qiita.com/mizchi/items/0e2db7c56541c46a7785" class="anchor" rel="noopener noreferrer" target="_blank">https://qiita.com/mizchi/items/0e2db7c56541c46a7785</a>)</p></div></article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":"{\"slug\":\"simple_and_typesafe_redux_reducer\",\"title\":\"TypeScriptで Redux の Reducer部分を型安全かつスッキリ書く\",\"publishedAt\":\"2018-05-08T06:17:14.000Z\",\"description\":\"TypeScriptのConditional Typesを利用してReduxの定義を完結に記述する解説です。\",\"tags\":[\"Redux\",\"TypeScript\"]}","content":"\u003ch2 class=\"heading lv-2\"\u003eはじめに\u003c/h2\u003e\n\u003cp class=\"paragraph\"\u003eTypeScript 2.8がリリースされ色々な機能が追加されました。\nその中でも\u003cem\u003eConditional types\u003c/em\u003e、特に\u003cem\u003eReturnType\u003c/em\u003eがなかなか優秀で\n今まで諦めていた部分がきれいに書けるようになっております。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003eそこで個人的にずさんになりがちな、ReduxのReducer周りを少し改良してみたのでご紹介\u003c/p\u003e\n\u003ch2 class=\"heading lv-2\"\u003eコード\u003c/h2\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token constant\"\u003eINCREMENT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'app/example/INCREMENT'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token constant\"\u003eSET_COUNT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'app/example/SET_COUNT'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003eincrement\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eINCREMENT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003esetCount\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enum\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token constant\"\u003eSET_COUNT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  payload\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    count\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e num\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eActions\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e ReturnType\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e increment\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n  \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e ReturnType\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e setCount\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eAppState\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// 本記事の趣旨に関係ないため割愛\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e initialState\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e AppState \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ereducer\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  state\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e AppState \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e initialState\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  action\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e Actions\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eswitch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaction\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"token constant\"\u003eINCREMENT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token builtin\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaction\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epayload\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// ↑ SET_COUNT以外でpayloadを参照するとエラーになる\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ebreak\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"token constant\"\u003eSET_COUNT\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token builtin\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaction\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epayload\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// ↑ OK\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ebreak\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edefault\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e _\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enever\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e action\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// ↑ ケースの定義もれがあった場合にエラーになる\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003e下で要点を解説していきます\nまた、今回は型をテーマにしていますので、\nReducerの処理自体は空っぽにしております\u003c/p\u003e\n\u003ch4 class=\"heading lv-4\"\u003eReturnTypeの利用\u003c/h4\u003e\n\u003cp class=\"paragraph\"\u003eTypeScript2.8の機能であるReturnTypeを利用することで、\nActionCreator関数の戻り値からActionの型を特定することができるようになりました。\nこうすることでAction型定義の管理が少しだけ楽になります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eActions\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e ReturnType\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e increment\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n  \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e ReturnType\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e setCount\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// ↓ こう解釈される\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eActions\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"app/example/INCREMENT\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"app/example/SET_COUNT\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    payload\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        count\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp class=\"paragraph\"\u003eTypeScript3.4で導入された \u003ccode class=\"code\"\u003econst assertion\u003c/code\u003e を利用することで各定数が\u003ccode class=\"code\"\u003estring\u003c/code\u003eではなく、\nその文字列の型として定義されるため↑のようにtypeが各アクションとして認識されます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript pre\"\u003e\u003ccode class=\"language-typescript code\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token constant\"\u003eINCREMENT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'app/example/INCREMENT'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token constant\"\u003eSET_COUNT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'app/example/SET_COUNT'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 class=\"heading lv-4\"\u003edefaultの部分\u003c/h4\u003e\n\u003cp class=\"paragraph\"\u003e\u003ccode class=\"code\"\u003edefault\u003c/code\u003e部分の\u003ccode class=\"code\"\u003enever\u003c/code\u003e型への代入については\u003ca href=\"https://qiita.com/wadahiro/items/9ec4af968a7314402499#_reference-ea5a7c38d951fc383cd3\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\"\u003eTypeScript 2.0のneverでTagged union typesの絞込を漏れ無くチェックする\u003c/a\u003e の記事で紹介されている素敵なテクニックです。\u003c/p\u003e\n\u003ch2 class=\"heading lv-2\"\u003e最後に\u003c/h2\u003e\n\u003cp class=\"paragraph\"\u003eTypeScriptではanyを多用すればエラーを黙らせることはできますが\nいかにして型安全に設計・実装できるかを考えるのが楽しいですよね。\u003c/p\u003e\n\u003cp class=\"paragraph\"\u003e実はもっといい方法があるのではないかと\nうずうずしていますので、いい案があればぜひ教えていただきたいです。\u003c/p\u003e\n\u003ch2 class=\"heading lv-2\"\u003e参考記事\u003c/h2\u003e\n\u003cp class=\"paragraph\"\u003e色々参考にさせていただきました。\u003c/p\u003e\n\u003cul class=\"list unordered\"\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/wadahiro/items/7c421b668f28a99e2a29\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\"\u003eRedux typed actions でReducerを型安全に書く (TypeScriptのバージョン別)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/wadahiro/items/9ec4af968a7314402499#_reference-ea5a7c38d951fc383cd3\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\"\u003eTypeScript 2.0のneverでTagged union typesの絞込を漏れ無くチェックする\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e[真・Flow \u0026#x26; Redux で Reducer の実装パターンを考える\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"paragraph\"\u003e](\u003ca href=\"https://qiita.com/mizchi/items/0e2db7c56541c46a7785\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\"\u003ehttps://qiita.com/mizchi/items/0e2db7c56541c46a7785\u003c/a\u003e)\u003c/p\u003e"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"simple_and_typesafe_redux_reducer"},"buildId":"2TeC_BqFkmcRD1K9YUrqZ","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-51ce6eb9ed73aacaf515.js"></script><script src="/_next/static/chunks/main-8741ed3c7ec57f378f59.js" async=""></script><script src="/_next/static/chunks/webpack-95c2b224bccf352ee870.js" async=""></script><script src="/_next/static/chunks/framework.daa7383ad2ab2e6757c1.js" async=""></script><script src="/_next/static/chunks/commons.286c5ad94e4334e87283.js" async=""></script><script src="/_next/static/chunks/pages/_app-62c4ae74494db6a57e9e.js" async=""></script><script src="/_next/static/chunks/79afb1f29f0e22fb2195c114356294f95861ebcc.293ad4049eec03f4e065.js" async=""></script><script src="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.26412b03d1df03d45396.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-d84c8237cab24ecd19e3.js" async=""></script><script src="/_next/static/2TeC_BqFkmcRD1K9YUrqZ/_buildManifest.js" async=""></script><script src="/_next/static/2TeC_BqFkmcRD1K9YUrqZ/_ssgManifest.js" async=""></script></body></html>