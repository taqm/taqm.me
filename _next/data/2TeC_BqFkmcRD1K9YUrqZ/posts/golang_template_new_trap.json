{"pageProps":{"post":"{\"slug\":\"golang_template_new_trap\",\"title\":\"Go言語のtext/templateでNewするときの名前について\",\"publishedAt\":\"2018-09-10T00:34:00.000Z\",\"description\":\"Go言語の標準パッケージ'text/template'を利用した際にハマった罠の解説です。\",\"tags\":[\"Golang\"]}","content":"<p class=\"paragraph\">Go言語の標準パッケージである<code class=\"code\">text/template</code>について\nけっこうハマってしまったのでメモとして残します。</p>\n<h2 class=\"heading lv-2\">.ParseFilesを利用する場合の、template.Newの引数</h2>\n<p class=\"paragraph\">まずは以下のコードを見てください</p>\n<div class=\"remark-highlight\"><pre class=\"language-go pre\"><code class=\"language-go code\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\ttmpl <span class=\"token string\">\"text/template\"</span>\n\t<span class=\"token string\">\"os\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tt <span class=\"token operator\">:=</span> tmpl<span class=\"token punctuation\">.</span><span class=\"token function\">Must</span><span class=\"token punctuation\">(</span>tmpl<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mytemplate\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ParseFiles</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> t<span class=\"token punctuation\">.</span><span class=\"token function\">Execute</span><span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>Stdout<span class=\"token punctuation\">,</span> <span class=\"token string\">\"taqm\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p class=\"paragraph\">■ test.txt</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown pre\"><code class=\"language-unknown code\">Hello {{ . }}</code></pre></div>\n<p class=\"paragraph\">test.txtを読み込んで、\"taqm\"というパラメータを渡して標準出力へ吐き出しています。\n実際にこのコードを実行してみると...</p>\n<blockquote>\n<p class=\"paragraph\">panic: template: \"mytemplate\" is an incomplete or empty template</p>\n</blockquote>\n<p class=\"paragraph\">なんか怒られた...\nこういうときはじっくりエラー文言を呼んでみることが重要！</p>\n<blockquote>\n<p class=\"paragraph\">\"mytemplate\"は不完全または空のテンプレートです [by Google翻訳]</p>\n</blockquote>\n<p class=\"paragraph\">「中身は空じゃないし文法がおかしかったのかな？」ってことで、\nテンプレートの文法がおかしいのかもう一度調べ直してみました。</p>\n<p class=\"paragraph\"><code class=\"code\">template.New</code>をせずに<code class=\"code\">template.ParseFiles</code>だと問題なく動くことを確認。\nつまり<code class=\"code\">New</code>していることが原因なのか？</p>\n<p class=\"paragraph\">調べていると<a href=\"https://qiita.com/akiraak/items/aa259b3988e00c2a3820\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\">ある記事</a>に答えはありました。</p>\n<p class=\"paragraph\"><code class=\"code\">template.New</code>の後ろで<code class=\"code\">ParseFiles</code>を呼ぶ場合は、\n<code class=\"code\">ParseFiles</code>の引数に設定するファイルパスの<strong>ファイル名</strong>を設定する必要があるらしい！</p>\n<div class=\"remark-highlight\"><pre class=\"language-go pre\"><code class=\"language-go code\">t <span class=\"token operator\">:=</span> tmpl<span class=\"token punctuation\">.</span><span class=\"token function\">Must</span><span class=\"token punctuation\">(</span>tmpl<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mytemplate\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ParseFiles</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p class=\"paragraph\">↓ mytemplateをファイル名に変更</p>\n<div class=\"remark-highlight\"><pre class=\"language-go pre\"><code class=\"language-go code\">t <span class=\"token operator\">:=</span> tmpl<span class=\"token punctuation\">.</span><span class=\"token function\">Must</span><span class=\"token punctuation\">(</span>tmpl<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ParseFiles</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p class=\"paragraph\">やっと動きました・・・＾＾\nなんだかんだ1時間くらいハマってしまいました。</p>\n<p class=\"paragraph\">素直にエラーメッセージでGoogle検索していればもっと早くに気付けたのかもしれません。\nですが、Goの公式ドキュメント見たり、ソースコードを見たりしたので\n結果的に得るものは多かったのかなと思います。</p>\n<p class=\"paragraph\">もし同じことでハマった人がすぐにこのページにたどり着けるといいなってことで！</p>\n<p class=\"paragraph\">おわり＾＾</p>\n<h2 class=\"heading lv-2\">参考ページ</h2>\n<ul class=\"list unordered\">\n<li><a href=\"https://qiita.com/akiraak/items/aa259b3988e00c2a3820\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\">html/templateで自作の関数を利用する</a></li>\n</ul>"},"__N_SSG":true}