{"pageProps":{"post":"{\"slug\":\"css_mine_sweeper\",\"title\":\"CSS（SCSS）だけでマインスイーパーを作ってみる\",\"publishedAt\":\"2019-02-04T22:41:06.000Z\",\"description\":\"JavaScriptを使わず、CSS(SCSS)のみでブラウザ上でマインスイーパーを実装してみた際の解説です。\",\"tags\":[\"CSS\",\"SASS\"]}","content":"<h2 class=\"heading lv-2\">はじめに</h2>\n<p class=\"paragraph\">みなさんマインスイーパーをご存知ですか？\nそうです！昔のWindowsに入っていたゲームです！</p>\n<p class=\"paragraph\">プログラミングの勉強の一環として作ったりすることも多い題材だと思いますが\n今回はSass（SCSS）のみで作ってみたいと思います。（JavaScriptは一切書きません）</p>\n<p class=\"paragraph\">※ これはマインスイーパーの記事になるので、Sass(SCSS)の解説は控えめになっております</p>\n<h2 class=\"heading lv-2\">成果物</h2>\n<p class=\"paragraph\">まず動くものは<a href=\"https://taqm.github.io/css-mine-sweeper/\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\">こちら</a>です\nソース →　<a href=\"https://github.com/taqm/css-mine-sweeper\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\">GitHub</a></p>\n<p class=\"paragraph\">本当は<strong>CodePen</strong>に投稿しようと思ったのですが\nソースコードの質が悪いようで動かなかったので諦めました:pensive:</p>\n<p class=\"paragraph\">あと、後述しますがビルド時のSCSSからCSSへ変換するタイミングで地雷の位置が決まるので\n上記のリンクは地雷の位置が変わることはありません...</p>\n<h2 class=\"heading lv-2\">利用技術</h2>\n<p class=\"paragraph\">以下のものを使っています</p>\n<ul class=\"list unordered\">\n<li>yarn</li>\n<li>SCSS</li>\n<li>Pug</li>\n<li>node-sass</li>\n</ul>\n<p class=\"paragraph\">プロジェクトには<code class=\"code\">stylelint</code>が入っていますが\n有効化するの忘れてたので警告（or エラー）まみれです。</p>\n<h3 class=\"heading lv-3\">スタイリング</h3>\n<p class=\"paragraph\">今回はFlexboxにてスタイリングを行っています。</p>\n<p class=\"paragraph\">そして、キレイなスタイリングよりも、ロジカルな部分に重きをおいているので\n見るに堪えないコードを書いている可能性があります。\nその点ご了承ください（<code class=\"code\">!important</code>とかは使ってないです）</p>\n<h2 class=\"heading lv-2\">解説</h2>\n<p class=\"paragraph\">すべてを解説するのは大変なので\n苦労したところ、工夫した以下を解説していきます。</p>\n<ul class=\"list unordered\">\n<li>地雷をランダムに配置</li>\n<li>マスを開く、フラグを立てる</li>\n<li>マスの周辺の地雷数を表示</li>\n<li>開いたマスの周りに地雷がない場合は周辺を探索</li>\n<li>残りの地雷数を表示</li>\n<li>クリア判定、ゲームオーバー判定</li>\n</ul>\n<p class=\"paragraph\">解説中に出てくるコードについてはかなり省略していますので、\n詳細が気になる方はGitHubのほうを参照してください</p>\n<h3 class=\"heading lv-3\">最初に</h3>\n<p class=\"paragraph\">今回のSCSSで書くにあたって以下の変数を用意しております。</p>\n<div class=\"remark-highlight\"><pre class=\"language-scss pre\"><code class=\"language-scss code\"><span class=\"token property\"><span class=\"token variable\">$row</span></span><span class=\"token punctuation\">:</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 横幅</span>\n<span class=\"token property\"><span class=\"token variable\">$col</span></span><span class=\"token punctuation\">:</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 縦幅</span>\n<span class=\"token property\"><span class=\"token variable\">$mineCount</span></span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 地雷の数</span>\n</code></pre></div>\n<p class=\"paragraph\">用途はコメントの通りです！\nでは各要素の解説をしていきます。</p>\n<h3 class=\"heading lv-3\">地雷をランダムに配置</h3>\n<p class=\"paragraph\">まずは地雷を配置しないことには始まりません。\n地雷の位置をべた書きではあんまりなのでランダムに配置したいところです。</p>\n<p class=\"paragraph\">「ランダムとか無理だろ・・・」と思っていたらうってつけの機能がありました。\nSCSSの組み込み関数に<code class=\"code\">random(n)</code>というものがあり、これがそのまま使えます。</p>\n<p class=\"paragraph\"><a href=\"https://qiita.com/tonkotsuboy_com/items/909b4073459ecaf7a435\" class=\"anchor\" rel=\"noopener noreferrer\" target=\"_blank\">参考記事はこちら</a></p>\n<p class=\"paragraph\">これを使うことでランダムに配置することは実現できそうですね。\nでは実際のコードを見てみます。</p>\n<div class=\"has-filename\"><div class=\"filename\">style.scss</div><pre class=\"language-scss pre\"><code class=\"language-scss code\"><span class=\"token property\"><span class=\"token variable\">$minePos</span></span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 地雷の位置配列</span>\n\n<span class=\"token keyword\">@for</span> <span class=\"token variable\">$i</span> <span class=\"token keyword\">from</span> <span class=\"token selector\">0 to <span class=\"token variable\">$mineCount</span> </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\"><span class=\"token variable\">$mine</span></span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\"><span class=\"token variable\">$continue</span></span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">@while</span> <span class=\"token selector\"><span class=\"token variable\">$continue</span> != null </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\"><span class=\"token variable\">$mine</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$row</span> <span class=\"token operator\">*</span> <span class=\"token variable\">$col</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\"><span class=\"token variable\">$continue</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$minePos</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$mine</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token property\"><span class=\"token variable\">$minePos</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$minePos</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$mine</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p class=\"paragraph\"><code class=\"code\">$col</code>, <code class=\"code\">$row</code>, <code class=\"code\">$mineCount</code>は事前に説明した変数たちになります。</p>\n<p class=\"paragraph\">今回の設計ではそれぞれのマスに「0〜63」の数字を振っています。\n<code class=\"code\">random</code>の結果すでに地雷として選出済みの数字が選ばれた場合は\nループを継続し、重複なく地雷が指定の個数選択されるようにしました。</p>\n<p class=\"paragraph\">これで地雷をランダムに配置するという課題は完了です。</p>\n<h4 class=\"heading lv-4\">問題</h4>\n<p class=\"paragraph\">この<code class=\"code\">random関数</code>はあくまでトランスパイルの時にランダムな数字を選ぶため\n一度CSSへ書き出してしまうともう変わることはありません。</p>\n<p class=\"paragraph\">ここの点は残念ですが仕方がないです...</p>\n<h3 class=\"heading lv-3\">マスを開く、フラグを立てる</h3>\n<p class=\"paragraph\">ユーザが行うことができるアクションの２つを実装していきましょう。\nもちろんSCSS縛りなので動的にクラス付与などはできません。</p>\n<p class=\"paragraph\">今回はINPUTタグのチェックボックスを用いて状態を判定していきます。</p>\n<p class=\"paragraph\">そして右クリックの判定など到底無理なので、\n「マスを開くモード」と「フラグを立てるモード」の２つを用意し、\nモードごとにチェックできるチェックボックスを切り替えていきます。</p>\n<p class=\"paragraph\">まずはHTML（Pug）の構造です。</p>\n<div class=\"has-filename\"><div class=\"filename\">index.pug</div><pre class=\"language-pug pre\"><code class=\"language-pug code\"><span class=\"token tag\">input<span class=\"token attr-id\">#normal-mode</span><span class=\"token attributes\"><span class=\"token punctuation\">(</span><span class=\"token attr-name\">type</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\"><span class=\"token string\">\"radio\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">name</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\"><span class=\"token string\">\"mode\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">checked</span><span class=\"token punctuation\">)</span></span></span>\n<span class=\"token tag\">input<span class=\"token attr-id\">#flag-mode</span><span class=\"token attributes\"><span class=\"token punctuation\">(</span><span class=\"token attr-name\">type</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\"><span class=\"token string\">\"radio\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">name</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\"><span class=\"token string\">\"mode\"</span></span><span class=\"token punctuation\">)</span></span></span>\n<span class=\"token tag\">p<span class=\"token attr-class\">.mode_control</span></span>\n  <span class=\"token tag\">label<span class=\"token attr-class\">.normal_mode</span><span class=\"token attributes\"><span class=\"token punctuation\">(</span><span class=\"token attr-name\">for</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\"><span class=\"token string\">\"normal-mode\"</span></span><span class=\"token punctuation\">)</span></span></span>\n    <span class=\"token tag\">span</span> <span class=\"token plain-text\">通常　</span>\n  <span class=\"token tag\">label<span class=\"token attr-class\">.flag_mode</span><span class=\"token attributes\"><span class=\"token punctuation\">(</span><span class=\"token attr-name\">for</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\"><span class=\"token string\">\"flag-mode\"</span></span><span class=\"token punctuation\">)</span></span></span>\n    <span class=\"token tag\">span</span> <span class=\"token plain-text\">フラグ</span>\n\n<span class=\"token punctuation\">-</span><span class=\"token code\"> <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&#x3C;</span> <span class=\"token number\">64</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></span>\n  <span class=\"token tag\">input<span class=\"token attributes\"><span class=\"token punctuation\">(</span><span class=\"token attr-name\">id</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\"><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">input-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>i<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-open</span><span class=\"token template-punctuation string\">`</span></span></span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">type</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\"><span class=\"token string\">\"checkbox\"</span></span><span class=\"token punctuation\">)</span></span></span>\n<span class=\"token punctuation\">-</span><span class=\"token code\"> <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&#x3C;</span> <span class=\"token number\">64</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></span>\n  <span class=\"token tag\">input<span class=\"token attr-class\">.flag_check</span><span class=\"token attributes\"><span class=\"token punctuation\">(</span><span class=\"token attr-name\">id</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\"><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">input-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>i<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-flag</span><span class=\"token template-punctuation string\">`</span></span></span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">type</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\"><span class=\"token string\">\"checkbox\"</span></span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token tag\"><span class=\"token attr-class\">.field</span></span>\n  <span class=\"token punctuation\">-</span><span class=\"token code\"> <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&#x3C;</span> <span class=\"token number\">64</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></span>\n    <span class=\"token tag\"><span class=\"token attr-class\">.cell</span></span>\n      <span class=\"token tag\">label<span class=\"token attr-class\">.mark_as_opened</span><span class=\"token attributes\"><span class=\"token punctuation\">(</span><span class=\"token attr-name\">for</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\"><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">input-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>i<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-open</span><span class=\"token template-punctuation string\">`</span></span></span><span class=\"token punctuation\">)</span></span></span>\n      <span class=\"token tag\">label<span class=\"token attr-class\">.mark_as_flag</span><span class=\"token attributes\"><span class=\"token punctuation\">(</span><span class=\"token attr-name\">for</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\"><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">input-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>i<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-flag</span><span class=\"token template-punctuation string\">`</span></span></span><span class=\"token punctuation\">)</span></span></span>\n</code></pre></div>\n<p class=\"paragraph\">これをHTMLへ変換すると以下のような形となります。</p>\n<div class=\"has-filename\"><div class=\"filename\">index.html</div><pre class=\"language-html pre\"><code class=\"language-html code\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>input</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>normal-mode<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>radio<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mode<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">checked</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>input</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>flag-mode<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>radio<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mode<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">checked</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>p</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mode_control<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>label</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>normal_mode<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>normal-mode<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>span</span><span class=\"token punctuation\">></span></span>通常<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>span</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>label</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>label</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>flag_mode<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>flag-mode<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>span</span><span class=\"token punctuation\">></span></span>フラグ<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>span</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>label</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>p</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>input</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>input-{i}-open<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>checkbox<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span> <span class=\"token comment\">&#x3C;!-- i = 0 ~ 64 --></span>\n...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>input</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>input-{i}-flag<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>checkbox<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>flag_check<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>field<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cell<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>label</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mark_as_opend<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>input-{i}-open<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>label</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>label</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mark_as_flag<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>input-{i}-flag<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>label</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>div</span><span class=\"token punctuation\">></span></span>\n  ...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>div</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p class=\"paragraph\">それではスタイルになりますー</p>\n<div class=\"remark-highlight\"><pre class=\"language-scss pre\"><code class=\"language-scss code\"><span class=\"token selector\">#normal-mode:checked ~ .field </span><span class=\"token punctuation\">{</span>\n  <span class=\"token selector\">.mark_as_opened </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token selector\">.mark_as_flag </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">#flag-mode:checked ~ .field </span><span class=\"token punctuation\">{</span>\n  <span class=\"token selector\">.mark_as_opened </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token selector\">.mark_as_flag </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">@mixin</span> <span class=\"token selector\">open </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> <span class=\"token hexcode color\">#EEE</span><span class=\"token punctuation\">;</span>\n  <span class=\"token selector\">.mark_as_opened,</span>\n<span class=\"token selector\">  .mark_as_flag </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">@for</span> <span class=\"token variable\">$i</span> <span class=\"token keyword\">from</span> <span class=\"token selector\">0 to <span class=\"token variable\">$col</span> * <span class=\"token variable\">$row</span> </span><span class=\"token punctuation\">{</span>\n  .<span class=\"token property\">cell</span><span class=\"token punctuation\">:</span><span class=\"token function\">nth-child</span><span class=\"token punctuation\">(</span>#<span class=\"token punctuation\">{</span><span class=\"token variable\">$i</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">#input-<span class=\"token variable\">#{$i}</span>-open:checked ~ .field <span class=\"token parent important\">&#x26;</span> </span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">@include</span> open<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">#input-<span class=\"token variable\">#{$i}</span>-flag:checked ~ .field <span class=\"token parent important\">&#x26;</span> </span><span class=\"token punctuation\">{</span>\n      <span class=\"token selector\"><span class=\"token parent important\">&#x26;</span>::before </span><span class=\"token punctuation\">{</span>\n        <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"🚩\"</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token selector\">.mark_as_opened </span><span class=\"token punctuation\">{</span>\n        <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p class=\"paragraph\">マスを開く動作は\n中にLABELを配置して、クリックしたら遠くのチェックボックスをチェックさせ\n無理やりな兄弟セレクタにより開いた状態となります。\nそして開いたマスには操作させたくないのでLABELを非表示にしちゃいましょう。</p>\n<p class=\"paragraph\">通常モードとフラグモードはラジオボタンで制御します。\n<code class=\"code\">#normal-mode</code>を選択している場合のみ<code class=\"code\">.mark_as_opened</code>を有効化。\nそして<code class=\"code\">#flag-mode</code>の時は<code class=\"code\">.mark_as_flag</code>を有効化。</p>\n<p class=\"paragraph\">これでマスをクリック時にチェックされるチェックボックスを切り分けることができるようになりました。</p>\n<p class=\"paragraph\">INPUTタグをかなり上の方に定義することで、兄弟要素としてセレクタを書きやすくなります。</p>\n<h3 class=\"heading lv-3\">マスの周辺の地雷数を表示</h3>\n<p class=\"paragraph\">マスを開いたので次は開いたときに表示するものを設定します。</p>\n<p class=\"paragraph\">表示されるものは以下の２つです。</p>\n<ul class=\"list unordered\">\n<li>地雷の数</li>\n<li>地雷そのもの</li>\n</ul>\n<p class=\"paragraph\">そこが地雷でないかつ、周りに地雷が１つもない場合は何も表示しません。\n（次のステップで詳しく触れます）</p>\n<p class=\"paragraph\">表示の方法は疑似要素<code class=\"code\">::before</code>にて表示していきましょう。</p>\n<div class=\"remark-highlight\"><pre class=\"language-scss pre\"><code class=\"language-scss code\"><span class=\"token keyword\">@mixin</span> <span class=\"token selector\">open </span><span class=\"token punctuation\">{</span>\n  <span class=\"token selector\"><span class=\"token parent important\">&#x26;</span>::before </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token unit\">%</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">justify-content</span><span class=\"token punctuation\">:</span> center<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">align-items</span><span class=\"token punctuation\">:</span> center<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token property\"><span class=\"token variable\">$mineSelector</span></span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">@for</span> <span class=\"token variable\">$i</span> <span class=\"token keyword\">from</span> <span class=\"token selector\">0 to <span class=\"token variable\">$col</span> * <span class=\"token variable\">$row</span> </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\"><span class=\"token variable\">$mines</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">countMine</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\"><span class=\"token variable\">$isMine</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">isMine</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  .<span class=\"token property\">cell</span><span class=\"token punctuation\">:</span><span class=\"token function\">nth-child</span><span class=\"token punctuation\">(</span>#<span class=\"token punctuation\">{</span><span class=\"token variable\">$i</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\"><span class=\"token parent important\">&#x26;</span>::before </span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">@if</span> <span class=\"token selector\"><span class=\"token variable\">$isMine</span> </span><span class=\"token punctuation\">{</span>\n        <span class=\"token property\"><span class=\"token variable\">$mineSelector</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$mineSelector</span><span class=\"token punctuation\">,</span> #<span class=\"token punctuation\">{</span>&#x26;<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'comma'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">@else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token function\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$mines</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#{$mines}\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token variable\">#{$mineSelector}</span> </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'■'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p class=\"paragraph\"><code class=\"code\">.cell</code>の疑似要素<code class=\"code\">::before</code>に<code class=\"code\">content</code>を設定していきます。\nデフォルトは<code class=\"code\">display:none</code>で、開いたときのみ表示させるようにしましょう。\n地雷の<code class=\"code\">content</code>をわざわざ外に出しているのは、\n当初は爆弾の画像をbase64で持たせようとして無駄を減らすつもりでしたが\n面倒になったので<code class=\"code\">■</code>にしてます:joy:</p>\n<h4 class=\"heading lv-4\">isMine, countMine</h4>\n<p class=\"paragraph\">ここで登場した<code class=\"code\">isMine</code>と<code class=\"code\">countMine</code>という自作関数の中身を見てきます。</p>\n<div class=\"remark-highlight\"><pre class=\"language-scss pre\"><code class=\"language-scss code\"><span class=\"token comment\">// そこが地雷かどうか</span>\n<span class=\"token keyword\">@function</span> <span class=\"token function\">isMine</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pos</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">@return</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$minePos</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$pos</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 周囲８マスの地雷の数を返却</span>\n<span class=\"token keyword\">@function</span> <span class=\"token function\">countMine</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pos</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\"><span class=\"token variable\">$count</span></span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">@each</span> <span class=\"token variable\">$n</span> in <span class=\"token function\">getNeighborIndex</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pos</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">@if</span> <span class=\"token function\">isMine</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$n</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\"><span class=\"token variable\">$count</span></span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$count</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">@return</span> <span class=\"token variable\">$count</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p class=\"paragraph\"><code class=\"code\">getNeighborIndex</code>では引数中心とした時の、周りの８マスに対応する数字の配列を返却してくれます。</p>\n<p class=\"paragraph\">先程の<strong>地雷をランダムに配置</strong>の章で準備した地雷の位置配列に\n周囲８マスの数字いくつ含まれるのかを判定します。</p>\n<h4 class=\"heading lv-4\">getNeighborIndex</h4>\n<p class=\"paragraph\">マスの周りの数字を返却してくれる関数です。\n今回は各マスを１次元の数値で管理しているためちょっと大変です。</p>\n<div class=\"remark-highlight\"><pre class=\"language-scss pre\"><code class=\"language-scss code\"><span class=\"token property\"><span class=\"token variable\">$areaOffsets</span></span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span>-<span class=\"token variable\">$col</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$col</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 上下</span>\n  <span class=\"token punctuation\">(</span>-<span class=\"token variable\">$col</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">-1</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$col</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 左側</span>\n  <span class=\"token punctuation\">(</span>-<span class=\"token variable\">$col</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> +<span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$col</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 右側</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// フィールドの範囲内か判定</span>\n<span class=\"token keyword\">@function</span> <span class=\"token function\">isValidPos</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pos</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">@return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token variable\">$pos</span> <span class=\"token operator\">>=</span> <span class=\"token number\">0</span> <span class=\"token operator\">and</span>\n    <span class=\"token variable\">$pos</span> <span class=\"token operator\">&#x3C;</span> <span class=\"token variable\">$row</span> <span class=\"token operator\">*</span> <span class=\"token variable\">$col</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 周辺８マスのポジションを取得</span>\n<span class=\"token keyword\">@function</span> <span class=\"token function\">getNeighborIndex</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$center</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\"><span class=\"token variable\">$wk</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">nth</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$areaOffsets</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">@if</span> <span class=\"token selector\"><span class=\"token variable\">$center</span> % <span class=\"token variable\">$col</span> != 0 </span><span class=\"token punctuation\">{</span> <span class=\"token comment\">// 左端の場合スキップ</span>\n    <span class=\"token property\"><span class=\"token variable\">$wk</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$wk</span><span class=\"token punctuation\">,</span> <span class=\"token function\">nth</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$areaOffsets</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">@if</span> <span class=\"token selector\"><span class=\"token variable\">$center</span> % <span class=\"token variable\">$col</span> != <span class=\"token variable\">$col</span> - 1 </span><span class=\"token punctuation\">{</span> <span class=\"token comment\">// 右恥の場合スキップ</span>\n    <span class=\"token property\"><span class=\"token variable\">$wk</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$wk</span><span class=\"token punctuation\">,</span> <span class=\"token function\">nth</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$areaOffsets</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token property\"><span class=\"token variable\">$ret</span></span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">@each</span> <span class=\"token selector\"><span class=\"token variable\">$offset</span> in <span class=\"token variable\">$wk</span> </span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">@if</span> <span class=\"token function\">isValidPos</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$center</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$offset</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 範囲外は省く</span>\n      <span class=\"token property\"><span class=\"token variable\">$ret</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ret</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$center</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$offset</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">@return</span> <span class=\"token variable\">$ret</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p class=\"paragraph\">まずは中心に対する周りのマスのオフセットを保持します。（<code class=\"code\">areaOffsets</code>）\nそして上下左右それぞれが有効なもののみ返却します。</p>\n<h3 class=\"heading lv-3\">開いたマスの周りに地雷がない場合は周辺を探索</h3>\n<p class=\"paragraph\">マインスイーパー自作時の醍醐味になります。\n大体の実装が再帰により実現されていると思いますが、\n今回も例に漏れず再帰を行います。</p>\n<div class=\"remark-highlight\"><pre class=\"language-scss pre\"><code class=\"language-scss code\"><span class=\"token keyword\">@function</span> <span class=\"token function\">getLinks</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$center</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$linked</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\"><span class=\"token variable\">$neighber</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">getNeighborIndex</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$center</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\"><span class=\"token variable\">$tmp</span></span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$linked</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">@each</span> <span class=\"token selector\"><span class=\"token variable\">$n</span> in <span class=\"token variable\">$neighber</span> </span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">@if</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$tmp</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$n</span><span class=\"token punctuation\">)</span> <span class=\"token selector\">== null </span><span class=\"token punctuation\">{</span>\n      <span class=\"token property\"><span class=\"token variable\">$c</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">countMine</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$n</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token property\"><span class=\"token variable\">$tmp</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$tmp</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$n</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">@if</span> <span class=\"token selector\"><span class=\"token variable\">$c</span> == 0 </span><span class=\"token punctuation\">{</span>\n        <span class=\"token property\"><span class=\"token variable\">$tmp</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">getLinks</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$n</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$tmp</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">@return</span> <span class=\"token variable\">$tmp</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">@for</span> <span class=\"token variable\">$i</span> <span class=\"token keyword\">from</span> <span class=\"token selector\">0 to <span class=\"token variable\">$col</span> * <span class=\"token variable\">$row</span> </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\"><span class=\"token variable\">$mines</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">countMine</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\"><span class=\"token variable\">$isMine</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">isMine</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">@if</span> <span class=\"token function\">not</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$isMine</span><span class=\"token punctuation\">)</span> <span class=\"token selector\">and <span class=\"token variable\">$mines</span> == 0 </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\"><span class=\"token variable\">$selector</span></span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">@each</span> <span class=\"token variable\">$p</span> in <span class=\"token function\">getLinks</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\"><span class=\"token variable\">$selector</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$selector</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#input-#{$i}-open:checked ~ .field .cell:nth-child(#{$p + 1})\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    #<span class=\"token punctuation\">{</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$selector</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'comma'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">@include</span> open<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token property\"><span class=\"token variable\">$debug</span></span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$selector</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p class=\"paragraph\">周りに地雷がない場合のみ、再帰による探索を行います。</p>\n<p class=\"paragraph\">一度探索した値をキャッシュとして保持すれば少し効率が上がるのですが\n出力されるCSSが変わるわけではないのでずさんな処理のままです。</p>\n<p class=\"paragraph\">「チェックの付いたチェックボックスと兄弟の<code class=\"code\">.field</code>内にあるマスN」\nという定義を大量に作っています。\n都度スタイルを宣言していてはCSSが大変なことになるので、\n配列にセレクタを詰めて一発でスタイルを当てましょう。</p>\n<h3 class=\"heading lv-3\">残りの地雷数を表示</h3>\n<p class=\"paragraph\">ゲームとして何個の地雷があるのかわからないと不便ですよね。\nそこで地雷が残りいくつあるのかを表示できるようにしましょう！</p>\n<div class=\"remark-highlight\"><pre class=\"language-scss pre\"><code class=\"language-scss code\"><span class=\"token property\"><span class=\"token variable\">$lastSelector</span></span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">@for</span> <span class=\"token variable\">$n</span> <span class=\"token keyword\">from</span> <span class=\"token number\">1</span> <span class=\"token keyword\">through</span> <span class=\"token selector\"><span class=\"token variable\">$row</span> * <span class=\"token variable\">$col</span> </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\"><span class=\"token variable\">$lastSelector</span></span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$lastSelector</span> <span class=\"token operator\">+</span> <span class=\"token string\">\".flag_check:checked ~\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token selector\"><span class=\"token variable\">#{$lastSelector}</span> .notice_area .last </span><span class=\"token punctuation\">{</span>\n    <span class=\"token selector\"><span class=\"token parent important\">&#x26;</span>::before </span><span class=\"token punctuation\">{</span>\n      <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"#{$mineCount - $n}\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\">.notice_area .last </span><span class=\"token punctuation\">{</span>\n  <span class=\"token selector\"><span class=\"token parent important\">&#x26;</span>::before </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"#{$mineCount}\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token selector\"><span class=\"token parent important\">&#x26;</span>::after </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'個'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p class=\"paragraph\">チェックの数をカウントするような形にしてみました。\n地雷の数 - チェックした数になるように兄弟セレクタを延々と並べます。</p>\n<p class=\"paragraph\">ちなみに０のときのセレクタはこんな感じ</p>\n<div class=\"remark-highlight\"><pre class=\"language-css pre\"><code class=\"language-css code\"><span class=\"token selector\"><span class=\"token class\">.flag_check</span><span class=\"token pseudo-class\">:checked</span> <span class=\"token combinator\">~</span> <span class=\"token class\">.flag_check</span><span class=\"token pseudo-class\">:checked</span> <span class=\"token combinator\">~</span> <span class=\"token class\">.flag_check</span><span class=\"token pseudo-class\">:checked</span> <span class=\"token combinator\">~</span> <span class=\"token class\">.flag_check</span><span class=\"token pseudo-class\">:checked</span> <span class=\"token combinator\">~</span> <span class=\"token class\">.flag_check</span><span class=\"token pseudo-class\">:checked</span> <span class=\"token combinator\">~</span> <span class=\"token class\">.flag_check</span><span class=\"token pseudo-class\">:checked</span> <span class=\"token combinator\">~</span> <span class=\"token class\">.flag_check</span><span class=\"token pseudo-class\">:checked</span> <span class=\"token combinator\">~</span> <span class=\"token class\">.flag_check</span><span class=\"token pseudo-class\">:checked</span> <span class=\"token combinator\">~</span> <span class=\"token class\">.flag_check</span><span class=\"token pseudo-class\">:checked</span> <span class=\"token combinator\">~</span> <span class=\"token class\">.flag_check</span><span class=\"token pseudo-class\">:checked</span> <span class=\"token combinator\">~</span> <span class=\"token class\">.notice_area</span> <span class=\"token class\">.last</span><span class=\"token pseudo-element\">::before</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p class=\"paragraph\">人間が読むものじゃないですねー</p>\n<h3 class=\"heading lv-3\">クリア判定、ゲームオーバー判定</h3>\n<p class=\"paragraph\">やっと最後のゲーム終了判定です。\nここもチェックボックスの状態に応じてスタイル当ててあげることで対応しましょう。</p>\n<p class=\"paragraph\"><strong>ゲームオーバーの判定</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-scss pre\"><code class=\"language-scss code\"><span class=\"token comment\">// ゲームオーバー判定</span>\n<span class=\"token property\"><span class=\"token variable\">$overSelector</span></span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">@each</span> <span class=\"token selector\"><span class=\"token variable\">$p</span> in <span class=\"token variable\">$minePos</span> </span><span class=\"token punctuation\">{</span>\n  <span class=\"token selector\">#input-<span class=\"token variable\">#{$p}</span>-open:checked ~ .game_over </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\"><span class=\"token variable\">$overSelector</span></span><span class=\"token punctuation\">:</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$overSelector</span><span class=\"token punctuation\">,</span> #<span class=\"token punctuation\">{</span>&#x26;<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'comma'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token variable\">#{$overSelector}</span> </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p class=\"paragraph\">地雷のチェックボックスが一つでもチェック状態になったら\nゲームオーバー領域の<code class=\"code\">display: none</code>を解除し、\n画面全体を覆うようにゲームオーバー画面を表示します。\nこれはとても素直です。</p>\n<p class=\"paragraph\"><strong>ゲームクリアの判定</strong>\nすべての地雷のマスにフラグが立ったらクリア判定にしたいです。\nしかし、それだとすべてのマスにフラグを立てたらクリアになってしまうので\n地雷以外の場所にフラグが立っていないことも条件とする必要がありました。</p>\n<div class=\"remark-highlight\"><pre class=\"language-scss pre\"><code class=\"language-scss code\"><span class=\"token property\"><span class=\"token variable\">$clearSelector</span></span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"input\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">@for</span> <span class=\"token variable\">$i</span> <span class=\"token keyword\">from</span> <span class=\"token selector\">0 to <span class=\"token variable\">$col</span> * <span class=\"token variable\">$row</span> </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\"><span class=\"token variable\">$wk</span></span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">@if</span> <span class=\"token function\">isMine</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\"><span class=\"token variable\">$wk</span></span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"#input-#{$i}-flag:checked\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">@else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\"><span class=\"token variable\">$wk</span></span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"#input-#{$i}-flag:not(:checked)\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token property\"><span class=\"token variable\">$clearSelector</span></span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$clearSelector</span> <span class=\"token operator\">+</span> <span class=\"token string\">' ~ '</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$wk</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token variable\">#{$clearSelector}</span> ~ .game_clear </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p class=\"paragraph\">「これで地雷の場所にのみフラグが立っている」というセレクタの完成です！！</p>\n<p class=\"paragraph\">あと<strong>ゲームオーバー</strong>と<strong>ゲームクリア</strong>の要素をlabel要素にし、\nINPUT(type=reset)に紐づけています。</p>\n<p class=\"paragraph\">こうすることで各要素クリック時にすべてのチェックが外れ\n初期状態に戻るようにしています。</p>\n<p class=\"paragraph\">これで何度でも遊べる！！！</p>\n<h2 class=\"heading lv-2\">あとがき</h2>\n<p class=\"paragraph\">軽い気持ちで始めてみましたが中々に骨が折れました...\nただ、配列操作や乱数生成など普通にスタイリングしているだけでは\n中々触ることのない機能を触ることができたので面白かったです:relaxed:</p>\n<p class=\"paragraph\">あと普通のプログラム言語にはない視点でのロジックを考える必要があり、色々と刺激を受けました！</p>\n<p class=\"paragraph\">今回は「CSSってこんな事もできるんですよ！」という紹介ということでやってみましたが、\n他にもやってる方が結構いるので実装を見比べてみるとおもしろいかもしれませんね:sunny:</p>\n<p class=\"paragraph\">それでは皆さんよいSassライフを！(^_^)/~</p>\n<hr>\n<p class=\"paragraph\">おしまい</p>"},"__N_SSG":true}